/*!
    *
    * Wijmo Library 5.20203.748
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("@grapecity/wijmo"),selfModule=__importStar(require("@grapecity/wijmo.input"));wijmo_1._addCultureInfo("InputNumber",{ariaLabels:{incVal:"Increase Value",decVal:"Decrease Value"}});class InputNumber extends wijmo_1.Control{constructor(e,t){super(e);this._value=null;this._min=null;this._max=null;this._format="";this._step=null;this._showBtn=!0;this._readOnly=!1;this._oldText="";this.textChanged=new wijmo_1.Event;this.valueChanged=new wijmo_1.Event;let i=this.hostElement;wijmo_1.setAttribute(i,"role","spinbutton",!0);let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-inputnumber",s,{_tbx:"input",_btnUp:"btn-inc",_btnDn:"btn-dec"},"input");let n=wijmo_1.culture.InputNumber.ariaLabels;wijmo_1.setAriaLabel(this._btnUp.querySelector("button"),n.incVal);wijmo_1.setAriaLabel(this._btnDn.querySelector("button"),n.decVal);this._tbx.type.match(/number/i)&&(this.inputType="");let h=this._tbx;h.autocomplete="off";h.spellcheck=!1;this._updateSymbols();let o=this.addEventListener.bind(this);o(h,"keypress",this._keypress.bind(this));o(h,"keydown",this._keydown.bind(this));o(h,"input",this._input.bind(this));o(h,"blur",()=>{this.text!=this._oldText&&this._setText(this.text)});o(h,"compositionstart",()=>{this._composing=!0});o(h,"compositionend",()=>{this._composing=!1;setTimeout(()=>{let e=this.text,t=this._oldText,i=this._chrPct;t&&t.indexOf(i)>-1&&e.indexOf(i)<0&&(e+=i);this._setText(e)})});let l=this._clickSpinner.bind(this);o(this._btnUp,"click",l);o(this._btnDn,"click",l);this._rptUp=new wijmo_1._ClickRepeater(this._btnUp.querySelector("button"));this._rptDn=new wijmo_1._ClickRepeater(this._btnDn.querySelector("button"));o(h,"wheel",e=>{if(!e.defaultPrevented&&!e.ctrlKey&&this._isEditable()&&this.containsFocus()){let t=wijmo_1.clamp(-e.deltaY,-1,1);this._increment((this.step||1)*t);setTimeout(()=>this.selectAll());e.preventDefault()}});this.value=0;this.isRequired=!0;this.initialize(t)}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(e){this._tbx.type=wijmo_1.asString(e)}get value(){return this._value}set value(e){if(e!=this._value)if(null==(e=wijmo_1.asNumber(e,!this.isRequired||null==e&&null==this._value)))this._setText("");else if(!isNaN(e)){let t=wijmo_1.Globalize.format(e,this.format);this._setText(t)}}get isRequired(){return this._tbx.required}set isRequired(e){this._tbx.required=wijmo_1.asBoolean(e)}get isReadOnly(){return this._readOnly}set isReadOnly(e){this._readOnly=wijmo_1.asBoolean(e);this.inputElement.readOnly=this._readOnly;wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}get min(){return this._min}set min(e){if(e!=this._min){this._min=wijmo_1.asNumber(e,!0);this._updateAria()}}get max(){return this._max}set max(e){if(e!=this._max){this._max=wijmo_1.asNumber(e,!0);this._updateAria()}}get step(){return this._step}set step(e){this._step=wijmo_1.asNumber(e,!0);this._updateBtn()}get format(){return this._format}set format(e){if(e!=this.format){this._format=wijmo_1.asString(e);this.refresh()}}get text(){return this._tbx.value}set text(e){if(e!=this.text){this._oldText=null;this._setText(e)}}get placeholder(){return this._tbx.placeholder}set placeholder(e){this._tbx.placeholder=e}get showSpinner(){return this._showBtn}set showSpinner(e){this._showBtn=wijmo_1.asBoolean(e);this._updateBtn()}get repeatButtons(){return!this._rptUp.disabled}set repeatButtons(e){this._rptUp.disabled=this._rptDn.disabled=!wijmo_1.asBoolean(e)}selectAll(){let e=this._tbx;wijmo_1.setSelectionRange(e,0,e.value.length)}clamp(e){return wijmo_1.clamp(e,this.min,this.max)}onTextChanged(e){this.textChanged.raise(this,e);this._updateState()}onValueChanged(e){this._updateAria();this.valueChanged.raise(this,e)}dispose(){this._rptUp.element=null;this._rptDn.element=null;super.dispose()}onGotFocus(e){this._oldValue=this.value;if(!this.isTouching){this._tbx.focus();this.selectAll()}super.onGotFocus(e)}onLostFocus(e){if(this._composing){this._composing=!1;this._setText(this.text)}if(this._isEditable()){let e=this.clamp(this.value);if(e==this.value||this.onInvalidInput(new wijmo_1.CancelEventArgs)){let t=wijmo_1.Globalize.format(e,this.format);this._setText(t)}}super.onLostFocus(e)}refresh(e=!0){super.refresh(e);if(this.hostElement){this._updateSymbols();let e=wijmo_1.Globalize.format(this.value,this.format);this._setText(e)}}_isEditable(){return!this.isReadOnly&&!this.isDisabled}_updateSymbols(){let e=wijmo_1.culture.Globalize.numberFormat,t=wijmo_1.Globalize._parseNumericFormat(this.format);this._chrDec=e["."]||".";this._chrTho=e[","]||",";this._chrNeg=e["-"]||"-";this._chrPls=e["+"]||"+";this._chrPct=e["%"]||"%";this._chrCur=t.curr||e.currency.symbol||"$";this._fmtSpc=t.spec;this._fmtPrc=t.prec;this._rxSym=new RegExp("^[%+\\-() \\"+this._chrDec+"\\"+this._chrCur+"\\"+this._chrNeg+"\\"+this._chrPls+"\\"+this._chrPct+"]*$");this._rxNeg=new RegExp("(\\-|\\(|\\"+this._chrNeg+")")}_isNumeric(e,t){let i=e==this._chrDec||e>="0"&&e<="9",s="x"==this._fmtSpc;!i&&s&&(i=e>="a"&&e<="f"||e>="A"&&e<="F");i||t||s||(i=e==this._chrPls||e==this._chrNeg||"("==e||")"==e);return i}_getInputRange(e){let t=[0,0],i=this.text,s=!1;for(let n=0;n<i.length;n++)if(this._isNumeric(i[n],e)){if(!s){t[0]=n;s=!0}t[1]=n+1}return t}_flipSign(){let e=this._getSelStartDigits();this.value*=-1;this._setSelStartDigits(e)}_getSelStartDigits(){let e=0,t=this._tbx.selectionStart,i=this._tbx.value;for(let s=0;s<i.length&&s<t;s++)this._isNumeric(i[s],!0)&&e++;return e}_setSelStartDigits(e){let t=this._tbx.value;for(let i=0;i<t.length&&e>=0;i++)if(this._isNumeric(t[i],!0)){if(!e){wijmo_1.setSelectionRange(this._tbx,i);break}e--}else if(!e){wijmo_1.setSelectionRange(this._tbx,i);break}}_increment(e){if(e){let t=this.clamp(wijmo_1.isNumber(this.value)?this.value+e:0),i=wijmo_1.Globalize.format(t,this.format,!1,!1);this._setText(i)}}_updateBtn(){let e=this.showSpinner&&!!this.step,t=e;wijmo_1.setCss([this._btnUp,this._btnDn],{display:e?"":"none"});wijmo_1.toggleClass(this.hostElement,"wj-input-show-spinner",e);wijmo_1.enable(this._btnUp,t);wijmo_1.enable(this._btnDn,t);this._updateAria()}_setText(e){if(this._composing)return;let t=this._tbx,i=this._rxNeg.test(e),s=this._delKey,n=this.containsFocus();e&&this._rxSym.test(e)&&n&&(e=this.isRequired||!s?"0":"");this._delKey=!1;s&&0==this.value&&!this.isRequired&&(e="");if(!e){if(!this.isRequired){t.value="";if(null!=this._value){this._value=null;this.onValueChanged()}if(this._oldText){this._oldText=e;this.onTextChanged()}this._updateBtn();return}e="0"}let h=this._chrDec,o=e.indexOf(h),l=this._format||(o>-1?"n2":"n0"),a=wijmo_1.Globalize.parseFloat(e,l);isFinite(a)||(a=this.clamp(a));if(isNaN(a)){this.onInvalidInput(new wijmo_1.CancelEventArgs)?t.value=this._oldText:this.focus();return}let r=n&&o>-1?2:null,_=wijmo_1.Globalize.format(a,l,!1,!1,r);i&&a>=0&&!s&&(_=this._chrNeg+_);n&&o>-1&&"g"==this._fmtSpc&&0!=this._fmtPrc&&(_=e).indexOf(h)<0&&(_+=h);if(t.value!=_){t.value=_;a=wijmo_1.Globalize.parseFloat(_,l)}if(a!=this._value){this._value=a;this.onValueChanged()}if(this.text!=this._oldText){this._oldText=this.text;this.onTextChanged()}this._updateBtn();this._updateState()}_keypress(e){if(!e.defaultPrevented&&!this._composing&&this._isEditable()&&e.charCode&&!e.ctrlKey&&!e.metaKey){let t=this._tbx,i=String.fromCharCode(e.charCode);if(this._isNumeric(i,!1)){let i=t.maxLength;if(i>-1&&t.value.length>=i&&t.selectionEnd==t.selectionStart){e.preventDefault();return}let s=this._getInputRange(!0),n=t.selectionStart,h=t.selectionEnd;if(n<s[0]&&h<t.value.length){h=Math.max(h,s[0]);wijmo_1.setSelectionRange(t,s[0],h)}if(n>=s[1]){let i=null!=this._fmtPrc?this._fmtPrc:2,s=t.value.indexOf(this._chrDec);s>-1&&n-s>i&&e.preventDefault()}}else e.preventDefault();switch(i){case"-":case this._chrNeg:if(this.clamp(-1)>=0)this.value<0&&this._flipSign();else if(this.value&&t.selectionStart==t.selectionEnd)this._flipSign();else if(this.clamp(-1)<0){t.value=this._chrNeg;wijmo_1.setSelectionRange(t,1)}e.preventDefault();break;case"+":case this._chrPls:this.value<0&&this._flipSign();e.preventDefault();break;case".":case this._chrDec:if(0==this._fmtPrc)e.preventDefault();else{let i=t.value.indexOf(this._chrDec);if(i>-1){t.selectionStart<=i&&i++;wijmo_1.setSelectionRange(t,i);e.preventDefault()}}}if(!e.defaultPrevented&&wijmo_1.isIE()){let s=t.value,n=t.selectionStart,h=t.selectionEnd;if(n==h){t.value=s.substr(0,n)+i+s.substr(h);wijmo_1.setSelectionRange(t,n+1);e.preventDefault();this._input()}}}}_keydown(e){this._delKey=!1;if(e.defaultPrevented||this._composing)return;if(wijmo_1.hasClass(this._tbx,"wj-grid-ime"))return;let t=this._tbx,i=t.value,s=t.selectionStart,n=t.selectionEnd;switch(e.keyCode){case 65:if(e.ctrlKey){setTimeout(()=>{this.selectAll()});e.preventDefault()}break;case wijmo_1.Key.Up:case wijmo_1.Key.Down:if(this.step&&this._isEditable()){this._increment(this.step*(e.keyCode==wijmo_1.Key.Up?1:-1));setTimeout(()=>{this.selectAll()});e.preventDefault()}break;case wijmo_1.Key.Back:this._delKey=!0;if(n-s<2&&this._isEditable()){let s=i[n-1];if(s==this._chrDec||s==this._chrPct||s==this._chrTho||")"==s){setTimeout(()=>{n=s==this._chrPct?this._getInputRange(!0)[1]:n-1;wijmo_1.setSelectionRange(t,n)});e.preventDefault()}}break;case wijmo_1.Key.Delete:this._delKey=!0;if(n-s<2&&this._isEditable())if("0"==i&&1==s)wijmo_1.setSelectionRange(t,0);else{let n=i[s];if(n==this._chrDec||n==this._chrPct){setTimeout(()=>{wijmo_1.setSelectionRange(t,s+1)});e.preventDefault()}}break;case wijmo_1.Key.Escape:this.value=this._oldValue;this.selectAll()}}_input(){this._composing||setTimeout(()=>{let e=this._tbx,t=e.value,i=t.indexOf(this._chrDec),s=e.selectionStart,n=this._getSelStartDigits();"p"==this._fmtSpc&&t.length&&t.indexOf(this._chrPct)<0&&(t+=this._chrPct);this._setText(t);if(this.containsFocus()){let h=e.value,o=h.indexOf(this._chrDec),l=this._getInputRange(!0);if(t==this._chrNeg+this._chrDec&&o>-1){wijmo_1.setSelectionRange(e,o+1);return}if(t[0]==this._chrNeg&&h[0]!=this._chrNeg){1==h.length?wijmo_1.setSelectionRange(e,1):this._setSelStartDigits(n);return}t?t==this._chrDec&&o>-1?s=o+1:s<=i&&o>-1||i<0&&o<0?s+=h.length-t.length:i<0&&o>-1&&(s=o):s=o>-1?o:l[1];s=wijmo_1.clamp(s,l[0],l[1]);wijmo_1.setSelectionRange(e,s)}})}_clickSpinner(e){if(!e.defaultPrevented&&this._isEditable()&&this.step){this._increment(this.step*(wijmo_1.contains(this._btnUp,e.target)?1:-1));this.isTouching||setTimeout(()=>this.selectAll())}}_updateAria(){let e=this.hostElement;if(e){wijmo_1.setAttribute(e,"aria-valuemin",this.min);wijmo_1.setAttribute(e,"aria-valuemax",this.max);wijmo_1.setAttribute(e,"aria-valuenow",this.value);wijmo_1.enable(this._btnDn,null==this.min||this.value>this.min);wijmo_1.enable(this._btnUp,null==this.max||this.value<this.max)}}}InputNumber.controlTemplate='<div class="wj-input"><div class="wj-input-group"><span wj-part="btn-dec" class="wj-input-group-btn" tabindex="-1"><button class="wj-btn wj-btn-default" tabindex="-1">-</button></span><input type="tel" wj-part="input" class="wj-form-control wj-numeric"/><span wj-part="btn-inc" class="wj-input-group-btn" tabindex="-1"><button class="wj-btn wj-btn-default" tabindex="-1">+</button></span></div></div>';exports.InputNumber=InputNumber;class InputMask extends wijmo_1.Control{constructor(e,t){super(e);this.valueChanged=new wijmo_1.Event;let i=this.getTemplate();this.applyTemplate("wj-control wj-content wj-inputmask",i,{_tbx:"input"},"input");if("INPUT"==this._orgTag){let e=this._tbx.getAttribute("value");e&&(this.value=e)}this._msk=new wijmo_1._MaskProvider(this._tbx);this.isRequired=!0;this.initialize(t);this.addEventListener(this._tbx,"input",()=>{this.onValueChanged()});this.addEventListener(this._tbx,"blur",this._commitText.bind(this));this.addEventListener(this._tbx,"keydown",e=>{e.keyCode==wijmo_1.Key.Enter&&this._commitText()})}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(e){this._tbx.type=wijmo_1.asString(e)}get value(){return this._tbx.value}set value(e){if(e!=this.value){this._tbx.value=wijmo_1.asString(e);e=this._msk._applyMask();this._tbx.value=e;this.onValueChanged()}}get rawValue(){return this._msk.getRawValue()}set rawValue(e){e!=this.rawValue&&(this.value=wijmo_1.asString(e))}get mask(){return this._msk.mask||""}set mask(e){let t=this.value;this._msk.mask=wijmo_1.asString(e);this.value!=t&&this.onValueChanged()}get promptChar(){return this._msk.promptChar}set promptChar(e){let t=this.value;this._msk.promptChar=e;this.value!=t&&this.onValueChanged()}get placeholder(){return this._tbx.placeholder}set placeholder(e){this._tbx.placeholder=e}get maskFull(){return this._msk.maskFull}get isRequired(){return this._tbx.required}set isRequired(e){this._tbx.required=wijmo_1.asBoolean(e)}get isReadOnly(){return this._tbx.readOnly}set isReadOnly(e){this._tbx.readOnly=wijmo_1.asBoolean(e);wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}selectAll(){let e=this._msk.getMaskRange();wijmo_1.setSelectionRange(this._tbx,e[0],e[1]+1)}onValueChanged(e){if(this.value!=this._oldValue){this._oldValue=this.value;this.valueChanged.raise(this,e)}this._updateState()}_commitText(){if((this.value||this.isRequired)&&!this.maskFull&&!this.onInvalidInput(new wijmo_1.CancelEventArgs)){let e=this._tbx,t=e.value,i=t.indexOf(this.promptChar);i>-1&&wijmo_1.setSelectionRange(e,i,t.length)}this._updateState()}dispose(){this._msk.input=null;super.dispose()}refresh(e=!0){super.refresh(e);this.hostElement&&this._msk.refresh()}onGotFocus(e){super.onGotFocus(e);this.selectAll()}}InputMask.controlTemplate='<div class="wj-input"><div class="wj-input-group"><input wj-part="input" class="wj-form-control"/></div></div>';exports.InputMask=InputMask;class ColorPicker extends wijmo_1.Control{constructor(e,t){super(e);this._hsb=[.5,1,1];this._alpha=1;this.valueChanged=new wijmo_1.Event;let i=this.getTemplate();this.applyTemplate("wj-control wj-content wj-colorpicker",i,{_eSB:"div-sb",_eHue:"div-hue",_eAlpha:"div-alpha",_ePreview:"div-pv",_ePal:"div-pal",_eText:"div-text"});this._palette="#FFF,#000,#F00,#FFC000,#FFFF00,#92D050,#00B050,#00B0F0,#0070C0,#7030A0".split(",");this._updatePalette();this._eHue.style.backgroundImage="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAD4CAIAAACi6hsPAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAGvSURBVDhPXdBPaM9xHMfxz4pWaxcmtoOhpdXSVpiyHWxqmVpDjaU5rK34XfypjTJ/p+ZPay6jhsOsRrKwaJElf9IQq03WIkv4FeMwMq221tfje1ByeFzfvd7PEKWGEKWTQRZLySWfVRRTQjmVbKWGOhLsZT+HaeY0bbTTQSfdXOcWffTzmAFeMcwoYyT5ygS/mA5hNgphip98J8kHRnnNSwZ4yH1uc4OrdHGR87RximYO0cgedlLLdqqoYAPrWMtKVrCcJSxiPmnMJUQp/Bsyk2xyyKOAQooopYwKtlDNDur5G7SBJo7RQiv/B+2hl3s84CkvGGKEOOYnxolj/mYmhBmDJ5ngCx95xxsGecYj4pB3iENeoZMO2mmlhaMcpIE4ZII6aqhmM3HMMkooopB88sghm0wySCeVlCjMCVFIYx4LWUwOeRSwhmLWU84mqqihll3sppEmjnOSs5zjEl1c4yZ99POE5wwxwns+840fTDFLFKaZZIJxkozxlmEGGSC+GF++Sy89dHOZC8Rr4lVnOMERDrCPBPXEX22jko2UEn+/mnxyWUYWC0gnNUQh/AEc0HJs6cex0gAAAABJRU5ErkJggg==)";this._eHue.style.backgroundSize="contain";if(navigator.appVersion.indexOf("MSIE 9")>-1){this._eSB.children[0].style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#ffffffff,endColorstr=#00ffffff,GradientType=1)";this._eSB.children[1].style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00000000,endColorstr=#ff000000,GradientType=0)"}i=ColorPicker._tplCursor;this._cSB=wijmo_1.createElement(i);this._cHue=wijmo_1.createElement(i);this._cHue.style.width="100%";this._cAlpha=wijmo_1.createElement(i);this._cAlpha.style.height="100%";this._eSB.appendChild(this._cSB);this._eHue.appendChild(this._cHue);this._eAlpha.appendChild(this._cAlpha);let s=this.addEventListener.bind(this),n=this.removeEventListener.bind(this),h=document;s(this.hostElement,"mousedown",e=>{s(h,"mousemove",mouseMove);s(h,"mouseup",mouseUp);this._mouseDown(e)});s(this.hostElement,"touchstart",e=>{s(h,"touchmove",mouseMove);s(h,"touchend",mouseUp);this._mouseDown(e)});let mouseMove=e=>{this._mouseMove(e)},mouseUp=e=>{n(h,"mousemove",mouseMove);n(h,"mouseup",mouseUp);n(h,"touchmove",mouseMove);n(h,"touchend",mouseUp);this._mouseUp(e)};s(this.hostElement,"click",e=>{let t=e.target;if(t&&"DIV"==t.tagName&&wijmo_1.contains(this._ePal,t)){let e=t.style.backgroundColor;e&&(this.value=new wijmo_1.Color(e).toString())}});this.value="#ffffff";this.initialize(t);this._updatePanels()}get showAlphaChannel(){return"none"!=this._eAlpha.parentElement.style.display}set showAlphaChannel(e){this._eAlpha.parentElement.style.display=wijmo_1.asBoolean(e)?"":"none"}get showColorString(){return"none"!=this._eText.style.display}set showColorString(e){this._eText.style.display=wijmo_1.asBoolean(e)?"":"none"}get value(){return this._value}set value(e){if(e!=this.value){e=wijmo_1.asString(e);let t=wijmo_1.Color.fromString(e);if(t){this._value=e;this._eText.innerText=e;let i=t.getHsb();if(this._hsb[0]!=i[0]||this._hsb[1]!=i[1]||this._hsb[2]!=i[2]||this._alpha!=t.a){if(0==i[2]){i[0]=this._hsb[0];i[1]=this._hsb[1]}else 0==i[1]&&(i[0]=this._hsb[0]);this._hsb=i;this._alpha=t.a;this._updatePanels();this.onValueChanged()}}}}get palette(){return this._palette}set palette(e){if((e=(e=wijmo_1.asArray(e)).slice(0,10)).every(e=>null!=wijmo_1.Color.fromString(e))){this._palette=e;this._updatePalette()}}onValueChanged(e){this._updatePanels();this.valueChanged.raise(this,e)}_mouseDown(e){this._htDown=this._getTargetPanel(e);if(this._htDown){e.preventDefault();this.focus();this._mouseMove(e)}}_mouseMove(e){var t=e.touches?e.touches[0]:e,i=this._htDown;if(i){let e=i.getBoundingClientRect(),s=this._hsb;if(i==this._eHue)s[0]=wijmo_1.clamp((t.clientY-e.top)/e.height,0,.99);else if(i==this._eSB){s[1]=wijmo_1.clamp((t.clientX-e.left)/e.width,0,1);s[2]=wijmo_1.clamp(1-(t.clientY-e.top)/e.height,0,1)}else i==this._eAlpha&&(this._alpha=wijmo_1.clamp((t.clientX-e.left)/e.width,0,1));this._updateColor()}}_mouseUp(e){this._htDown=null}_updateColor(){let e=wijmo_1.Color.fromHsb(this._hsb[0],this._hsb[1],this._hsb[2],this._alpha);this.value=e.toString();this._updatePanels()}_updatePalette(){let e=new wijmo_1.Color("#fff"),t=new wijmo_1.Color("#000");this._ePal.innerHTML="";for(let i=0;i<this._palette.length;i++){let s=wijmo_1.createElement('<div style="float:left;width:10%;box-sizing:border-box;padding:1px">'),n=new wijmo_1.Color(this._palette[i]),h=n.getHsb();s.appendChild(this._makePalEntry(n,4));for(let i=0;i<5;i++){if(0==h[1]){let s=.1*i+(h[2]>.5?.05:.55);n=wijmo_1.Color.interpolate(e,t,s)}else n=wijmo_1.Color.fromHsb(h[0],.1+.2*i,1-.1*i);s.appendChild(this._makePalEntry(n,0))}this._ePal.appendChild(s)}}_makePalEntry(e,t){let i=document.createElement("div");wijmo_1.setCss(i,{cursor:"pointer",backgroundColor:e.toString(),marginBottom:t||""});i.innerHTML="&nbsp";return i}_updatePanels(){let e=wijmo_1.Color.fromHsb(this._hsb[0],1,1,1),t=wijmo_1.Color.fromHsb(this._hsb[0],this._hsb[1],this._hsb[2],1);this._eSB.style.backgroundColor=e.toString();this._eAlpha.style.background="linear-gradient(to right, transparent 0%, "+t.toString()+" 100%)";navigator.appVersion.indexOf("MSIE 9")>-1&&(this._eAlpha.style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00000000,endColorstr="+t.toString()+", GradientType = 1)");this._ePreview.style.backgroundColor=this.value;this._cHue.style.top=(100*this._hsb[0]).toFixed(0)+"%";this._cSB.style.left=(100*this._hsb[1]).toFixed(0)+"%";this._cSB.style.top=(100-100*this._hsb[2]).toFixed(0)+"%";this._cAlpha.style.left=(100*this._alpha).toFixed(0)+"%"}_getTargetPanel(e){let t=e.target;return wijmo_1.contains(this._eSB,t)?this._eSB:wijmo_1.contains(this._eHue,t)?this._eHue:wijmo_1.contains(this._eAlpha,t)?this._eAlpha:null}}ColorPicker.controlTemplate='<div style="position:relative;width:100%;height:100%"><div style="float:left;width:50%;height:100%;box-sizing:border-box;padding:2px"><div wj-part="div-pal"><div style="float:left;width:10%;box-sizing:border-box;padding:2px"><div style="background-color:black;width:100%">&nbsp;</div><div style="height:6px"></div></div></div><div wj-part="div-text" style="position:absolute;bottom:0px;display:none"></div></div><div style="float:left;width:50%;height:100%;box-sizing:border-box;padding:2px"><div wj-part="div-sb" class="wj-colorbox" style="float:left;width:89%;height:89%"><div style="position:absolute;width:100%;height:100%;background:linear-gradient(to right, white 0%,transparent 100%)"></div><div style="position:absolute;width:100%;height:100%;background:linear-gradient(to top, black 0%,transparent 100%)"></div></div><div style="float:left;width:1%;height:89%"></div><div style="float:left;width:10%;height:89%"><div wj-part="div-hue" class="wj-colorbox"></div></div><div style="float:left;width:89%;height:1%"></div><div style="float:left;width:89%;height:10%"><div style="width:100%;height:100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAAcSURBVBhXY/iPBBYgAWpKQGkwgMqDAdUk/v8HAM7Mm6GatDUYAAAAAElFTkSuQmCC)"><div wj-part="div-alpha" class="wj-colorbox"></div></div></div><div style="float:left;width:1%;height:10%"></div><div style="float:left;width:10%;height:10%"><div wj-part="div-pv" class="wj-colorbox" style="position:static"></div></div></div></div>';ColorPicker._tplCursor='<div style="position:absolute;left:50%;top:50%;width:7px;height:7px;transform:translate(-50%,-50%);border:2px solid #f0f0f0;border-radius:50px;box-shadow:0px 0px 4px 2px #0f0f0f"></div>';exports.ColorPicker=ColorPicker;class CollectionViewNavigator extends wijmo_1.Control{constructor(e,t){super(e);this._view=null;this._byPage=!1;this._fmt="{current:n0} / {count:n0}";let i=this.getTemplate();this.applyTemplate("wj-control wj-content wj-pager wj-collectionview-navigator",i,{_btnFirst:"btn-first",_btnPrev:"btn-prev",_txtCurr:"txt-curr",_btnNext:"btn-next",_btnLast:"btn-last"},"input");this._rptNext=new wijmo_1._ClickRepeater(this._btnNext.querySelector("button"));this._rptPrev=new wijmo_1._ClickRepeater(this._btnPrev.querySelector("button"));this.addEventListener(this.hostElement,"click",this._click.bind(this));this.initialize(t);this._update()}get cv(){return this._view}set cv(e){if(e!=this._view){let t=this._view;if(t){t.collectionChanged.removeHandler(this._collectionChanged);t.currentChanged.removeHandler(this._currentChanged)}t=this._view=wijmo_1.asType(e,"ICollectionView",!0);this._update();if(t){t.collectionChanged.addHandler(this._collectionChanged,this);t.currentChanged.addHandler(this._currentChanged,this)}}}get byPage(){return this._byPage}set byPage(e){if(e!=this._byPage){this._byPage=wijmo_1.asBoolean(e);this._update()}}get headerFormat(){return this._fmt}set headerFormat(e){if(e!=this._fmt){this._fmt=wijmo_1.asString(e);this._update()}}get repeatButtons(){return!this._rptNext.disabled}set repeatButtons(e){this._rptNext.disabled=this._rptPrev.disabled=!wijmo_1.asBoolean(e)}_update(){let e=this._view,t=this._byPage,i=e?t?e.pageIndex:e.currentPosition:0,s=e?t?e.pageCount:e.itemCount:0;wijmo_1.enable(this._btnFirst,e&&i>0);wijmo_1.enable(this._btnPrev,e&&i>0);wijmo_1.enable(this._txtCurr,null!=e);wijmo_1.enable(this._btnNext,e&&i<s-1);wijmo_1.enable(this._btnLast,e&&i<s-1);this._txtCurr.value=wijmo_1.format(this._fmt,{current:e?i+1:0,count:e?s:0,currentItem:e?e.currentPosition+1:0,itemCount:e?e.itemCount:0,currentPage:e?e.pageIndex+1:0,pageCount:e?e.pageCount:0})}_currentChanged(){this._update()}_collectionChanged(){this._update()}_click(e){let t=e.target,i=this._view,s=this._byPage;if(i){wijmo_1.contains(this._btnFirst,t)?s?i.moveToFirstPage():i.moveCurrentToFirst():wijmo_1.contains(this._btnPrev,t)?s?i.moveToPreviousPage():i.moveCurrentToPrevious():wijmo_1.contains(this._btnNext,t)?s?i.moveToNextPage():i.moveCurrentToNext():wijmo_1.contains(this._btnLast,t)&&(s?i.moveToLastPage():i.moveCurrentToLast());e.preventDefault()}}}CollectionViewNavigator.controlTemplate='<div class="wj-input-group"><span wj-part="btn-first" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-step-backward"></span></button></span><span wj-part="btn-prev" class="wj-input-group-btn"> <button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-left"></span> </button></span><input wj-part="txt-curr" class="wj-form-control" readonly><span wj-part="btn-next" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-right"></span></button></span><span wj-part="btn-last" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-step-forward"></span></button></span></div>';exports.CollectionViewNavigator=CollectionViewNavigator;class ListBox extends wijmo_1.Control{constructor(e,t){super(e);this._pathDisplay=new wijmo_1.Binding("");this._pathValue=new wijmo_1.Binding("");this._pathChecked=new wijmo_1.Binding("");this._html=!1;this._shGroups=!1;this._itemRole="option";this._checking=!1;this._search="";this._caseSensitive=!1;this._fmtItemHandlers=0;this._itemCount=0;this.selectedIndexChanged=new wijmo_1.Event;this.itemsChanged=new wijmo_1.Event;this.loadingItems=new wijmo_1.Event;this.loadedItems=new wijmo_1.Event;this.itemChecked=new wijmo_1.Event;this.checkedItemsChanged=new wijmo_1.Event;this.formatItem=new wijmo_1.Event(()=>{this.invalidate()});this.applyTemplate("wj-control wj-content wj-listbox",null,null);let i=this.hostElement;wijmo_1.setAttribute(i,"role","listbox",!0);"SELECT"==this._orgTag&&this._initFromSelect(this.hostElement);this.addEventListener(i,"click",this._click.bind(this));this.addEventListener(i,"keydown",this._keydown.bind(this));this.addEventListener(i,"keypress",this._keypress.bind(this));this.addEventListener(i,"wheel",e=>{if(i.scrollHeight>i.offsetHeight&&(e.deltaY<0&&0==i.scrollTop||e.deltaY>0&&i.scrollTop+i.offsetHeight>=i.scrollHeight)){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation()}});this.initialize(t)}get itemsSource(){return this._items}set itemsSource(e){if(this._items!=e){if(this._cv){this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this);this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this);this._cv=null}this._items=e;this._checkedItems=null;this._cv=wijmo_1.asCollectionView(e);if(null!=this._cv){this._cv.currentChanged.addHandler(this._cvCurrentChanged,this);this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this)}this._populateList();this.onItemsChanged();this.onSelectedIndexChanged()}}get collectionView(){return this._cv}get showGroups(){return this._shGroups}set showGroups(e){if(e!=this._shGroups){this._shGroups=wijmo_1.asBoolean(e);this._populateList()}}get isContentHtml(){return this._html}set isContentHtml(e){if(e!=this._html){this._html=wijmo_1.asBoolean(e);this._populateList()}}get itemFormatter(){return this._itemFormatter}set itemFormatter(e){if(e!=this._itemFormatter){this._itemFormatter=wijmo_1.asFunction(e);this._populateList()}}get displayMemberPath(){return this._pathDisplay.path}set displayMemberPath(e){if(e!=this.displayMemberPath){this._pathDisplay.path=wijmo_1.asString(e);this._populateList()}}get selectedValuePath(){return this._pathValue.path}set selectedValuePath(e){this._pathValue.path=wijmo_1.asString(e)}get checkedMemberPath(){return this._pathChecked.path}set checkedMemberPath(e){if(e!=this.checkedMemberPath){this._pathChecked.path=wijmo_1.asString(e);this._populateList()}}get caseSensitiveSearch(){return this._caseSensitive}set caseSensitiveSearch(e){this._caseSensitive=wijmo_1.asBoolean(e)}get itemRole(){return this._itemRole}set itemRole(e){if(e!=this.itemRole){this._itemRole=wijmo_1.asString(e);this._populateList()}}getDisplayValue(e){let t=null;if(e>-1&&wijmo_1.hasItems(this._cv)){t=this._cv.items[e];this.displayMemberPath&&(t=this._pathDisplay.getValue(t))}let i=null!=t?t.toString():"";this._itemFormatter&&(i=this._itemFormatter(e,i));return i}getDisplayText(e){let t=this._getChild(e);return null!=t?t.textContent:""}isItemEnabled(e){var t=this._getChild(e);return null!=t&&!t.hasAttribute("disabled")&&!wijmo_1.hasClass(t,"wj-state-disabled")&&!wijmo_1.hasClass(t,"wj-separator")}get selectedIndex(){return this._cv?this._cv.currentPosition:-1}set selectedIndex(e){this._cv&&this._cv.moveCurrentToPosition(wijmo_1.asNumber(e))}get selectedItem(){return this._cv?this._cv.currentItem:null}set selectedItem(e){this._cv&&this._cv.moveCurrentTo(e)}get selectedValue(){let e=this.selectedItem;e&&this.selectedValuePath&&(e=this._pathValue.getValue(e));return e}set selectedValue(e){let t=this._cv,i=t?t.items:null,s=this.selectedValuePath,n=-1;if(i){for(let t=0;t<i.length;t++){let h=i[t],o=s?this._pathValue.getValue(h):h;if(o===e||wijmo_1.DateTime.equals(o,e)){n=t;break}if(this.isContentHtml&&wijmo_1.isString(o)&&o.indexOf("<")>-1&&wijmo_1.toPlainText(o)===e){n=t;break}}this.selectedIndex=n}}get maxHeight(){let e=this.hostElement,t=e?parseFloat(e.style.maxHeight):null;return isNaN(t)?null:t}set maxHeight(e){let t=this.hostElement;if(t){e=wijmo_1.asNumber(e,!0);t.style.maxHeight=null==e?"":e+"px"}}showSelection(e){let t=this.selectedIndex,i=this.hostElement,s=i.children;t=this._getElementIndex(t);for(let e=0;e<s.length;e++){let i=s[e],n=e==t,h=this.checkedMemberPath?this._getCheckbox(e):null,o=h?h.checked:null;wijmo_1.toggleClass(i,"wj-state-selected",n);wijmo_1.setAttribute(i,"aria-selected",this._getAriaSelected(n,o));i.tabIndex=n?this._orgTabIndex:-1}if(t>-1&&t<s.length){let e=s[t].getBoundingClientRect(),n=i.getBoundingClientRect(),h=0;if(this._shGroups){let e=s[0];wijmo_1.hasClass(e,"wj-header")&&(h=e.offsetHeight)}e.bottom>n.bottom?i.scrollTop+=e.bottom-n.bottom:e.top<n.top+h&&(i.scrollTop-=n.top+h-e.top)}if(t>-1){null==e&&(e=this.containsFocus());if(e){let e=s[t];e instanceof HTMLElement&&!wijmo_1.contains(e,wijmo_1.getActiveElement())&&e.focus()}}i.tabIndex=t<0?this._orgTabIndex:-1}loadList(){this._populateList()}getItemChecked(e){let t=this._cv.items[e],i=this._pathChecked;if(wijmo_1.isObject(t)&&i.path)return i.getValue(t);let s=this._getCheckbox(e);return!!s&&s.checked}setItemChecked(e,t){this._setItemChecked(e,t,!0)}toggleItemChecked(e){this.setItemChecked(e,!this.getItemChecked(e))}get checkedItems(){null==this._checkedItems&&(this._checkedItems=this._getCheckedItems());return this._checkedItems}set checkedItems(e){let t=wijmo_1.asArray(e,!1),i=this._cv,s=this._pathChecked,n=new Map;if(!this._arrayEquals(t,this.checkedItems)){if(s&&i){let e=i.sourceCollection;if(e&&e.length){wijmo_1.isObject(e[0])||(s=null);t=t.filter(t=>e.indexOf(t)>-1);this._checking=!0;let i=[];e.forEach(e=>{let h=t.indexOf(e)>-1;if(h){i.push(e);n.set(e,!0)}s&&s.setValue(e,h)});this._checking=!1;t=i}}i.items.forEach((e,t)=>{this._setItemChecked(t,null!=n.get(e),!1)});this._checkedItems=t;this.onCheckedItemsChanged()}}indexOf(e){if(this._shGroups&&wijmo_1.hasClass(e,"wj-header"))return-1;let t=this.hostElement.children;for(let i=0,s=0;i<t.length;i++){let n=t[i];if(wijmo_1.contains(t[i],e))return s;this._shGroups&&wijmo_1.hasClass(n,"wj-header")||s++}return-1}onSelectedIndexChanged(e){this.selectedIndexChanged.raise(this,e)}onItemsChanged(e){this.itemsChanged.raise(this,e)}onLoadingItems(e){this.loadingItems.raise(this,e)}onLoadedItems(e){this.loadedItems.raise(this,e)}onItemChecked(e){this.itemChecked.raise(this,e)}onCheckedItemsChanged(e){this.checkedItemsChanged.raise(this,e)}onFormatItem(e){this.formatItem.raise(this,e)}refresh(e=!0){super.refresh(e);if(this.hostElement){let e=this._cv?this._cv.items.length:0,t=this.formatItem.handlerCount;if(e!=this._itemCount||t!=this._fmtItemHandlers){this._fmtItemHandlers=t;this._populateList()}}}_getCheckedItems(){let e=this._cv,t=e instanceof wijmo_1.CollectionView&&e.pageSize>0,i=this._pathChecked,s=[];if(e&&i&&i.path){let n=e.filter,h=this._checkedItems;s=e.sourceCollection.filter((s,o)=>{if(n&&!n(s))return!1;if(wijmo_1.isObject(s))return i.getValue(s);if(h)return h.indexOf(s)>-1;{let i=t?e.items.indexOf(s):o;return this.getItemChecked(i)}})}return s}_arrayEquals(e,t){if(e==t)return!0;if(!e||!t||e.length!=t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!=t[i])return!1;return!0}_getChild(e){e=this._getElementIndex(e);return this.hostElement.children[e]}_getElementIndex(e){if(this._shGroups){let t=this.hostElement.children;for(let i=0;i<=e&&i<t.length;i++){let s=t[i];wijmo_1.hasClass(s,"wj-header")&&e++}}return e}_setItemChecked(e,t,i=!0){let s=this._cv.items[e],n=this._pathChecked,h=!1,o=this.selectedIndex,l=this._checking;if(wijmo_1.isObject(s)&&n.path){if(n.getValue(s)!=t){let e=wijmo_1.tryCast(this._cv,"IEditableCollectionView");h=!0;this._checking=!0;if(e){e.editItem(s);n.setValue(s,t);e.commitEdit()}else{n.setValue(s,t);e.refresh()}this._checking=l}}else h=!0;let a=this._getCheckbox(e);if(a){a.checked=t;let e=wijmo_1.closest(a,".wj-listbox-item");if(e){wijmo_1.toggleClass(e,"wj-state-checked",t);wijmo_1.setAttribute(e,"aria-selected",!!t||null)}}if(i){if(h){this._checkedItems=null;this.onItemChecked();this.onCheckedItemsChanged()}o!=this.selectedIndex&&this.onSelectedIndexChanged()}return h}_cvCollectionChanged(){if(!this._checking){this._populateList();this.onItemsChanged()}}_cvCurrentChanged(){if(!this._checking){this.showSelection();this.onSelectedIndexChanged()}}_populateList(){let e=this.hostElement,t=this._cv;this._itemCount=t?t.items.length:0;if(e){let i,s=this.containsFocus(),n=-1;this.onLoadingItems();e.textContent="";e.scrollTop=0;if(t){let s,h=[],o=0;n=t.currentPosition;if(this._shGroups&&t.groups&&t.groups.length){i={};for(let e=0;e<t.groups.length;e++){let n=t.groups[e];i[o]=n;s=this._createHeaderItem(n);h.push(s);for(let e=0;e<n.items.length;e++,o++){s=this._createItem(o);h.push(s)}}}else for(let e=0;e<t.items.length;e++,o++){s=this._createItem(o);h.push(s)}e.innerHTML=h.join("")}if(this.formatItem.hasHandlers&&t){let s=e.children,n=t.items,h=0,o=new FormatItemEventArgs(0,null,null);for(let e=0;e<s.length;e++){o._item=s[e];if(this._shGroups&&wijmo_1.hasClass(o._item,"wj-header")){o._index=-1;o._data=i[h]}else{o._index=h;o._data=n[h];h++}this.onFormatItem(o)}}0==e.children.length&&e.appendChild(document.createElement("div"));e.tabIndex=n<0?this._orgTabIndex:-1;if(s){(n>=0?e.children[this._getElementIndex(n)]:e).focus()}else n>0&&this.showSelection();this.checkedItems=this._getCheckedItems();this.onLoadedItems()}}_createItem(e){let t=this._cv.items[e],i=e==this._cv.currentPosition,s=this.getDisplayValue(e);1!=this._html&&(s=wijmo_1.escapeHtml(s));let n=null;if(this.checkedMemberPath){n=!1;wijmo_1.isObject(t)?n=!!this._pathChecked.getValue(t):this._checkedItems&&(n=this._checkedItems.indexOf(t)>-1);s='<label><input type="checkbox" tabindex="-1"'+(n?" checked":"")+"><span></span> "+s+"</label>"}let h="wj-listbox-item";i&&(h+=" wj-state-selected");n&&(h+=" wj-state-checked");if(this._html){let e=["wj-separator","wj-state-disabled"];if(s.indexOf(e[0])>-1||s.indexOf(e[1])>-1){let t=wijmo_1.createElement(s);e.forEach(e=>{wijmo_1.hasClass(t,e)&&(h+=" "+e)})}}return'<div class="'+h+'" role="'+this.itemRole+'" '+(this._getAriaSelected(i,n)?'aria-selected="true" ':"")+'tabindex="'+(i?this._orgTabIndex:-1)+'">'+s+"</div>"}_getAriaSelected(e,t){return!!(null!=t?t:e)||null}_createHeaderItem(e){return'<div class="wj-listbox-item wj-header wj-state-disabled" role="presentation" tabindex="-1">'+wijmo_1.escapeHtml(e.name)+"</div>"}_click(e){if(0==e.button&&!e.defaultPrevented){let t=this.indexOf(e.target);if(t>-1){this.selectedIndex=t;if(this.checkedMemberPath){let i=this._getCheckbox(t),s=this.hostElement.children[t];if(i==e.target||e.target==s){s.focus({preventScroll:!0});this.setItemChecked(t,i.checked)}}}}}_keydown(e){let t=this.selectedIndex;if(!e.defaultPrevented){if(65==e.keyCode&&(e.ctrlKey||e.metaKey)){let t=this.collectionView;if(this.checkedMemberPath&&wijmo_1.hasItems(t)){this.checkedItems=this.checkedItems.length!=t.items.length?t.items:[];e.preventDefault();return}}if(!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey))switch(e.keyCode){case wijmo_1.Key.Down:e.preventDefault();this._selectNext();break;case wijmo_1.Key.Up:e.preventDefault();this._selectPrev();break;case wijmo_1.Key.Home:e.preventDefault();this._selectFirst();break;case wijmo_1.Key.End:e.preventDefault();this._selectLast();break;case wijmo_1.Key.PageDown:e.preventDefault();this._selectNextPage();break;case wijmo_1.Key.PageUp:e.preventDefault();this._selectPrevPage();break;case wijmo_1.Key.Space:if(this.checkedMemberPath&&t>-1){let i=this._getCheckbox(t);if(i&&this.isItemEnabled(t)){this.setItemChecked(t,!i.checked);e.preventDefault()}}}}}_keypress(e){if(!e.defaultPrevented&&!(e.target instanceof HTMLInputElement)&&(e.charCode>32||32==e.charCode&&this._search)){e.preventDefault();this._search+=String.fromCharCode(e.charCode);this._toSearch&&clearTimeout(this._toSearch);this._toSearch=setTimeout(()=>{this._toSearch=null;this._search=""},wijmo_1.Control._SEARCH_DELAY);let t=this._findNext();if(t<0&&this._search.length>1){this._search=this._search[this._search.length-1];t=this._findNext()}t>-1&&(this.selectedIndex=t)}}_selectNext(){let e=this.hostElement.children.length;for(let t=this.selectedIndex+1;t<e;t++)if(this.isItemEnabled(t)){this.selectedIndex=t;return!0}return!1}_selectPrev(){for(let e=this.selectedIndex-1;e>=0;e--)if(this.isItemEnabled(e)){this.selectedIndex=e;return!0}return!1}_selectFirst(){let e=this.hostElement.children.length;for(let t=0;t<e;t++)if(this.isItemEnabled(t)){this.selectedIndex=t;return!0}return!1}_selectLast(){for(let e=this.hostElement.children.length-1;e>=0;e--)if(this.isItemEnabled(e)){this.selectedIndex=e;return!0}return!1}_selectNextPage(){let e=this.hostElement,t=e.offsetHeight,i=e.children,s=0;for(let e=this.selectedIndex+1;e<this._cv.items.length;e++){let n=i[e].scrollHeight;if(s+n>t&&this.isItemEnabled(e)){this.selectedIndex=e;return!0}s+=n}return this._selectLast()}_selectPrevPage(){let e=this.hostElement,t=e.offsetHeight,i=e.children,s=0;for(let e=this.selectedIndex-1;e>0;e--){let n=i[e].scrollHeight;if(s+n>t&&this.isItemEnabled(e)){this.selectedIndex=e;return!0}s+=n}return this._selectFirst()}_findNext(){if(this.hostElement){let e=this.hostElement.childElementCount,t=this.selectedIndex;(t<0||1==this._search.length)&&t++;let i=this._search,s=this.caseSensitiveSearch;s||(i=i.toLowerCase());for(let n=0;n<e;n++){let h=(t+n)%e;if(this.isItemEnabled(h)){let e=this.getDisplayText(h).trim();s||(e=e.toLowerCase());if(0==e.indexOf(i))return h}}}return-1}_getCheckbox(e){let t=this.hostElement,i=t?t.children:null;e=this._getElementIndex(e);return t&&e>-1&&e<i.length?i[e].querySelector("input[type=checkbox]"):null}_initFromSelect(e){let t=e.children,i=[],s=-1;for(let n=0;n<t.length;n++){let h=t[n];if("OPTION"==h.tagName){h.hasAttribute("selected")&&(s=i.length);h.innerHTML?i.push({hdr:h.innerHTML,val:h.getAttribute("value"),cmdParam:h.getAttribute("cmd-param")}):i.push({hdr:'<div class="wj-separator"></div>'});e.removeChild(h);n--}}if(i){this.displayMemberPath="hdr";this.selectedValuePath="val";this.itemsSource=i;this.selectedIndex=s}}}exports.ListBox=ListBox;class FormatItemEventArgs extends wijmo_1.EventArgs{constructor(e,t,i){super();this._index=wijmo_1.asNumber(e);this._data=t;this._item=wijmo_1.asType(i,HTMLElement,!0)}get index(){return this._index}get data(){return this._data}get item(){return this._item}}exports.FormatItemEventArgs=FormatItemEventArgs;wijmo_1._addCultureInfo("MultiSelectListBox",{filterPlaceholder:"Filter",selectAll:"Select All"});class MultiSelectListBox extends wijmo_1.Control{constructor(e,t){super(e);this._selectAllLabel=null;this._filterPlaceholder=null;this._filterText="";this._checkOnFilter=!0;this._delay=wijmo_1.Control._SEARCH_DELAY;this.checkedItemsChanged=new wijmo_1.Event;let i=this.getTemplate();this.applyTemplate("wj-control wj-content wj-multiselectlistbox",i,{_selectAll:"select-all",_filter:"filter",_lbHost:"list-box"});this._selectAll.style.display="none";this._filter.style.display="none";this._lbx=new ListBox(this._lbHost,{checkedMemberPath:MultiSelectListBox._DEF_CHECKED_PATH,loadedItems:()=>this._updateCheckAllCheckbox(),checkedItemsChanged:()=>this.onCheckedItemsChanged()});this._cbSelectAll=this._selectAll.querySelector("input[type=checkbox]");this._spSelectAll=this._selectAll.querySelector("label>span");let s=wijmo_1.culture.MultiSelectListBox;wijmo_1.setText(this._spSelectAll,s.selectAll);this._filter.placeholder=s.filterPlaceholder;this.initialize(t);this.addEventListener(this._filter,"input",()=>{if(this._filter.value!=this._filterText){this._filterText=this._filter.value;this._toSearch&&clearTimeout(this._toSearch);this._toSearch=setTimeout(()=>{this._toSearch=null;this._applyFilter()},this.delay)}});this.addEventListener(this._cbSelectAll,"click",e=>{let t=this._lbx.collectionView;wijmo_1.hasItems(t)&&(this.checkedItems=e.target.checked?t.items:[])});this.addEventListener(this.hostElement,"keydown",e=>{let t=this.showFilterInput?this._filter:null,i=this._lbx;if(t&&e.keyCode==wijmo_1.Key.F3){wijmo_1.setSelectionRange(t,0,t.value.length);e.preventDefault()}wijmo_1.getActiveElement()==t&&e.stopPropagation();if(!i.containsFocus())switch(e.keyCode){case wijmo_1.Key.Up:case wijmo_1.Key.Down:this._lbx.focus();let t=i.selectedIndex+(e.keyCode==wijmo_1.Key.Up?-1:1);i.selectedIndex=Math.max(0,t);e.preventDefault()}},!0)}get itemsSource(){return this._lbx.itemsSource}set itemsSource(e){this._lbx.itemsSource=e}get collectionView(){return this._lbx.collectionView}get displayMemberPath(){return this._lbx.displayMemberPath}set displayMemberPath(e){this._lbx.displayMemberPath=e}get isContentHtml(){return this._lbx.isContentHtml}set isContentHtml(e){this._lbx.isContentHtml=e}get caseSensitiveSearch(){return this._lbx.caseSensitiveSearch}set caseSensitiveSearch(e){this._lbx.caseSensitiveSearch=e}get delay(){return this._delay}set delay(e){this._delay=wijmo_1.asNumber(e,!1,!0)}get showGroups(){return this._lbx.showGroups}set showGroups(e){this._lbx.showGroups=e}get checkOnFilter(){return this._checkOnFilter}set checkOnFilter(e){if(e!=this.checkOnFilter){this._checkOnFilter=wijmo_1.asBoolean(e);this.checkedItems=[]}}get selectedIndex(){return this._lbx.selectedIndex}set selectedIndex(e){this._lbx.selectedIndex=e}get listBox(){return this._lbx}get showFilterInput(){return""==this._filter.style.display}set showFilterInput(e){if(e!=this.showFilterInput){this._filter.style.display=wijmo_1.asBoolean(e)?"":"none";if(!this.showFilterInput){this._filter.value="";this._applyFilter()}}}get filterInputPlaceholder(){return this._filterPlaceholder}set filterInputPlaceholder(e){if(e!=this._filterPlaceholder){this._filterPlaceholder=wijmo_1.asString(e);this.refresh()}}get showSelectAllCheckbox(){return""==this._selectAll.style.display}set showSelectAllCheckbox(e){this._selectAll.style.display=wijmo_1.asBoolean(e)?"":"none"}get selectAllLabel(){return this._selectAllLabel}set selectAllLabel(e){if(e!=this._selectAllLabel){this._selectAllLabel=wijmo_1.asString(e);this.refresh()}}get checkedMemberPath(){let e=this.listBox.checkedMemberPath;return e!=MultiSelectListBox._DEF_CHECKED_PATH?e:null}set checkedMemberPath(e){e=wijmo_1.asString(e);this.listBox.checkedMemberPath=e||MultiSelectListBox._DEF_CHECKED_PATH}get checkedItems(){return this.listBox.checkedItems}set checkedItems(e){this.listBox.checkedItems=wijmo_1.asArray(e)}onCheckedItemsChanged(e){this._updateCheckAllCheckbox();this.checkedItemsChanged.raise(this,e)}refresh(e=!0){super.refresh(e);if(this.hostElement){let e=wijmo_1.culture.MultiSelectListBox;this._filter.placeholder=null!=this._filterPlaceholder?this._filterPlaceholder:e.filterPlaceholder;this._spSelectAll&&wijmo_1.setText(this._spSelectAll,null!=this._selectAllLabel?this._selectAllLabel:e.selectAll);this._updateCheckAllCheckbox()}}dispose(){this.listBox.dispose();super.dispose()}_applyFilter(){let e=this._lbx,t=e.collectionView,i=this._filter.value,s=i?new RegExp(wijmo_1.escapeRegExp(i),e.caseSensitiveSearch?"":"i"):null,n=this.displayMemberPath,h=n?new wijmo_1.Binding(n):null;t.filter=e=>{if(null!=s){h&&(e=h.getValue(e));this.isContentHtml&&(e=wijmo_1.toPlainText(e));return null!=e&&s.test(e.toString())}return!0};e.selectedIndex=Math.max(0,e.selectedIndex);this._checkOnFilter&&(this.checkedItems=s?t.items:[])}_updateCheckAllCheckbox(){let e=this._lbx.collectionView,t=this._cbSelectAll;if(wijmo_1.hasItems(e)){let i=e.items.length,s=this.checkedItems.length;wijmo_1.setChecked(t,s==i||0!=s&&null);t.disabled=!1}else{wijmo_1.setChecked(t,!1);t.checked=!1;t.disabled=!0}}}MultiSelectListBox._DEF_CHECKED_PATH="$checked";MultiSelectListBox.controlTemplate='<div class="wj-template wj-listbox"><input wj-part="filter" class="wj-form-control"><div wj-part="select-all" class="wj-header wj-select-all wj-listbox-item"><label><input type="checkbox" tabindex="-1"> <span></span></label></div><div wj-part="list-box"/></div>';exports.MultiSelectListBox=MultiSelectListBox;wijmo_1._addCultureInfo("Calendar",{ariaLabels:{calendar:"Calendar",monthView:"Month View",yearView:"Year View",prvMo:"Previous Month",today:"Today",nxtMo:"Next Month",prvYr:"Previous Year",currMo:"Current Month",nxtYr:"Next Year"}});var DateSelectionMode,ShowMonthPicker,ClickAction,PopupTrigger,_Edges;!function(e){e[e.None=0]="None";e[e.Day=1]="Day";e[e.Month=2]="Month";e[e.Range=3]="Range"}(DateSelectionMode=exports.DateSelectionMode||(exports.DateSelectionMode={}));!function(e){e[e.None=0]="None";e[e.FirstMonth=1]="FirstMonth";e[e.LastMonth=2]="LastMonth";e[e.FirstAndLastMonths=3]="FirstAndLastMonths";e[e.AllMonths=4]="AllMonths";e[e.Outside=5]="Outside"}(ShowMonthPicker=exports.ShowMonthPicker||(exports.ShowMonthPicker={}));class Calendar extends wijmo_1.Control{constructor(e,t){super(e);this._yrPicker=!0;this._mtPicker=ShowMonthPicker.FirstMonth;this._wksBefore=0;this._wksAfter=0;this._rngMin=0;this._rngMax=0;this._min=null;this._max=null;this._readOnly=!1;this._fdw=null;this._selMode=DateSelectionMode.Day;this._tmYrHidden=0;this._fmtYrMo="y";this._fmtYr="yyyy";this._fmtDayHdr="ddd";this._fmtDay="d ";this._fmtMonths="MMM";this.valueChanged=new wijmo_1.Event;this.rangeEndChanged=new wijmo_1.Event;this.displayMonthChanged=new wijmo_1.Event;this.formatItem=new wijmo_1.Event(()=>{this.invalidate()});this._value=this._rngEnd=wijmo_1.DateTime.newDate();this._month=this._getMonth(this._value);this._cals=[this];this._createChildren();this._createYearPicker();let i=this.hostElement,s=this.addEventListener.bind(this);s(i,"keydown",this._keydown.bind(this));s(i,"click",this._click.bind(this));this._rptUp=new wijmo_1._ClickRepeater(this._btnPrv);this._rptDn=new wijmo_1._ClickRepeater(this._btnNxt);this.addEventListener(i,"wheel",e=>{if(!e.defaultPrevented&&!this.isReadOnly&&this.containsFocus()){e.deltaY<0?this._btnPrv.click():this._btnNxt.click();e.preventDefault()}});this.initialize(t);this.refresh(!0)}get value(){return this._value}set value(e){if(e!==this._value){this._clearingRangeEnd=!wijmo_1.DateTime.equals(this._value,e);this.rangeEnd=null;this._clearingRangeEnd=!1;e=wijmo_1.asDate(e,!0);e=this._clamp(e);if(this._valid(e)||null==e){this.ensureVisible(e);if(!wijmo_1.DateTime.equals(this._value,e)){this._value=e;this.invalidate(!1);this.onValueChanged()}}}}get rangeEnd(){return this._rngEnd}set rangeEnd(e){e=wijmo_1.asDate(e,!0);if((e=this._clamp(e))&&this._value&&this._rngMode()){e<this._value&&(e=this._value);let t=this._rngMin,i=this._rngMax;if(t&&t>0||i&&i>0){let s=this._value,n=Math.ceil((e.getTime()-s.getTime())/864e5)+1;t&&t>0&&n<t&&(e=wijmo_1.DateTime.addDays(s,t-1));i&&i>0&&n>i&&(e=wijmo_1.DateTime.addDays(s,i-1))}}if((this._valid(e)||null==e)&&!wijmo_1.DateTime.equals(this._rngEnd,e)){this._rngEnd=e;this.ensureVisible(e);this.invalidate(!1);this.onRangeEndChanged()}}get rangeMin(){return this._rngMin}set rangeMin(e){if((e=wijmo_1.asNumber(e,!0,!0))!=this._rngMin){this._rngMin=e;this._syncProp(this,"rangeMin");this._rngMode()&&this._rngEnd&&(this.rangeEnd=this._rngEnd)}}get rangeMax(){return this._rngMax}set rangeMax(e){if((e=wijmo_1.asNumber(e,!0,!0))!=this._rngMax){this._rngMax=e;this._syncProp(this,"rangeMax");this._rngMode()&&this._rngEnd&&(this.rangeEnd=this._rngEnd)}}get min(){return this._min}set min(e){if((e=wijmo_1.asDate(e,!0))!=this.min){this._min=e;this._syncProp(this,"min");this.refresh();!this.value&&e&&e>this.displayMonth&&this.ensureVisible(e)}}get max(){return this._max}set max(e){if((e=wijmo_1.asDate(e,!0))!=this.max){this._max=e;this._syncProp(this,"max");this.refresh();!this.value&&e&&e<this.displayMonth&&this.ensureVisible(e)}}get selectionMode(){return this._selMode}set selectionMode(e){let t=DateSelectionMode;if((e=wijmo_1.asEnum(e,t))!=this._selMode){this._selMode=e;this._mthMode()&&(this.monthView=!1);this._rngEnd=e==t.Range?this._value:null;this.refresh();this._syncProp(this,"selectionMode")}}get isReadOnly(){return this._readOnly}set isReadOnly(e){this._readOnly=wijmo_1.asBoolean(e);wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly);this._syncProp(this,"isReadOnly")}get repeatButtons(){return!this._rptUp.disabled}set repeatButtons(e){this._rptUp.disabled=this._rptDn.disabled=!wijmo_1.asBoolean(e);this._syncProp(this,"repeatButtons")}get showYearPicker(){return this._yrPicker}set showYearPicker(e){if(e!=this._yrPicker){this._yrPicker=wijmo_1.asBoolean(e);this._syncProp(this,"showYearPicker")}}get showMonthPicker(){return this._mtPicker}set showMonthPicker(e){if(e!=this._mtPicker){let t=ShowMonthPicker;wijmo_1.isBoolean(e)&&(e=e?t.FirstMonth:t.None);this._mtPicker=wijmo_1.asEnum(e,t);wijmo_1.toggleClass(this.hostElement,"wj-btns-outside",this._getShowMonthPicker()==t.Outside);this.refresh();this._syncProp(this,"showMonthPicker")}}get firstDayOfWeek(){return this._fdw}set firstDayOfWeek(e){if(e!=this._fdw){if((e=wijmo_1.asNumber(e,!0))&&(e>6||e<0))throw"firstDayOfWeek must be between 0 and 6 (Sunday to Saturday).";this._fdw=e;this.refresh();this._syncProp(this,"firstDayOfWeek")}}get displayMonth(){return this._month}set displayMonth(e){e=wijmo_1.asDate(e);e=this._getMonth(e);let t=this._getDisplayMonthRange();t.to&&e>t.to&&(e=t.to);t.from&&e<t.from&&(e=t.from);if(!wijmo_1.DateTime.equals(this.displayMonth,e)){this._month=e;this.invalidate(!0);this.onDisplayMonthChanged()}}get monthCount(){return this.hostElement.querySelectorAll(".wj-calendar").length+1}set monthCount(e){if(e!=this.monthCount){let t=this.hostElement,i=t.querySelectorAll(".wj-calendar");e=wijmo_1.asInt(e,!1);wijmo_1.assert(e>0,"monthCount must be >= 1.");wijmo_1.assert(1==e||!wijmo_1.closest(t.parentElement,".wj-calendar"),"Only top-level calendars can set monthCount.");for(let e=0;e<i.length;e++){let t=i[e];wijmo_1.removeChild(t);this._getCalendar(t).dispose()}this._cals=[this];for(let i=1;i<e;i++){let e=new Calendar(document.createElement("div"),{itemFormatter:this.itemFormatter,itemValidator:this.itemValidator,formatItem:(e,t)=>this.onFormatItem(t)});for(let t in this)if(!/^(_.*|constructor|displayMonth|monthCount|hostElement|rightToLeft|isUpdating|isTouching)$/.test(t)){let i=this[t];wijmo_1.isFunction(i)||i instanceof wijmo_1.Event||(e[t]=i)}this._cals.push(e);t.appendChild(e.hostElement)}wijmo_1.toggleClass(t,"wj-calendar-multimonth",e>1);this._syncProp(this,"displayMonth")}}get formatYearMonth(){return this._fmtYrMo}set formatYearMonth(e){if(e!=this._fmtYrMo){this._fmtYrMo=wijmo_1.asString(e);this.invalidate()}}get formatDayHeaders(){return this._fmtDayHdr}set formatDayHeaders(e){if(e!=this._fmtDayHdr){this._fmtDayHdr=wijmo_1.asString(e);this.invalidate()}}get formatDays(){return this._fmtDay}set formatDays(e){if(e!=this._fmtDay){this._fmtDay=wijmo_1.asString(e);this.invalidate()}}get formatYear(){return this._fmtYr}set formatYear(e){if(e!=this._fmtYr){this._fmtYr=wijmo_1.asString(e);this.invalidate()}}get formatMonths(){return this._fmtMonths}set formatMonths(e){if(e!=this._fmtMonths){this._fmtMonths=wijmo_1.asString(e);this.invalidate()}}get showHeader(){return"none"!=this._tbHdr.style.display}set showHeader(e){if(e!=this.showHeader){this._tbHdr.style.display=wijmo_1.asBoolean(e)?"":"none";this._syncProp(this,"showHeader")}}get monthView(){return"none"!=this._tbMth.style.display}set monthView(e){if(e!=this.monthView){this._tbMth.style.display=e?"":"none";this._tbYr.style.display=e?"none":"";this.refresh();let t=wijmo_1.culture.Calendar.ariaLabels;wijmo_1.setAriaLabel(this._btnPrv,e?t.prvMo:t.prvYr);wijmo_1.setAriaLabel(this._btnTdy,e?t.today:t.currMo);wijmo_1.setAriaLabel(this._btnNxt,e?t.nxtMo:t.nxtYr);wijmo_1.setAriaLabel(this._btnMth,e?t.monthView:t.yearView);this._syncProp(this,"monthView")}}get weeksBefore(){return this._wksBefore}set weeksBefore(e){if(e!=this._wksBefore){this._wksBefore=Math.floor(wijmo_1.asNumber(e,!1,!0));this._syncProp(this,"weeksBefore");this.invalidate()}}get weeksAfter(){return this._wksAfter}set weeksAfter(e){if(e!=this._wksAfter){this._wksAfter=Math.floor(wijmo_1.asNumber(e,!1,!0));this._syncProp(this,"weeksAfter");this.invalidate()}}get itemFormatter(){return this._itemFormatter}set itemFormatter(e){if(e!=this._itemFormatter){this._itemFormatter=wijmo_1.asFunction(e);this._syncProp(this,"itemFormatter");this.invalidate()}}get itemValidator(){return this._itemValidator}set itemValidator(e){if(e!=this._itemValidator){this._itemValidator=wijmo_1.asFunction(e);this._syncProp(this,"itemValidator");this.invalidate()}}hitTest(e){return(e=wijmo_1.closest(e,"td"))?e[Calendar._DATE_KEY]:null}ensureVisible(e){if(null!=e){let t=this._getCalendars(),i=t.indexOf(this),s=t[0],n=t[t.length-1];e<s.displayMonth?this.displayMonth=wijmo_1.DateTime.addMonths(this._getMonth(e),i):e>n.displayMonth&&(this.displayMonth=wijmo_1.DateTime.addMonths(this._getMonth(e),i-t.length+1))}}onValueChanged(e){this.valueChanged.raise(this,e);this._syncProp(this,"value")}onRangeEndChanged(e){this.rangeEndChanged.raise(this,e);this._syncProp(this,"rangeEnd")}onDisplayMonthChanged(e){this.displayMonthChanged.raise(this,e);this._syncProp(this,"displayMonth")}onFormatItem(e){this.formatItem.raise(this,e)}containsFocus(){return super.containsFocus()||this._lbYears.containsFocus()}dispose(){this._rptUp.element=null;this._rptDn.element=null;this._lbYears.dispose();super.dispose()}refresh(e=!0){let t=this.hostElement,i=this.containsFocus();if(!t)return;super.refresh(e);e&&this._updateContent();this._updateSelection();let s=this._getDisplayMonthRange(),n=this.displayMonth;wijmo_1.enable(this._btnPrv,null==s.from||n>s.from);wijmo_1.enable(this._btnNxt,null==s.to||n<s.to);if(i){let e=(this.monthView?this._tbMth:this._tbYr).querySelector("td.wj-state-selected")||t;e&&e.focus()}let h=this._getCalendars();h.length>1&&this==h[0]&&h.forEach((t,i)=>{i>0&&t.refresh(e)})}_getShowMonthPicker(){let e=ShowMonthPicker,t=this._getCalendars(),i=t.indexOf(this),s=this.showMonthPicker;switch(s){case e.FirstMonth:case e.Outside:return 0==i?s:0;case e.LastMonth:return i==t.length-1?s:0;case e.FirstAndLastMonths:return 0==i||i==t.length-1?s:0;case e.AllMonths:return s}return 0}_getDisplayMonthRange(){let e={from:null,to:null};if(this.min||this.max){let t=this._getCalendars(),i=t.indexOf(this),s=this._mthMode()?wijmo_1.DateTime.addYears:wijmo_1.DateTime.addMonths;this.min&&(e.from=s(this._getMonth(this.min),i));this.max&&(e.to=s(this._getMonth(this.max),i-t.length+1))}return e}_getCalendar(e){return wijmo_1.Control.getControl(e)}_getCalendars(){let e=wijmo_1.closest(this.hostElement,".wj-calendar-multimonth");return(e?this._getCalendar(e):this)._cals}_syncProp(e,t){if(!this._syncing){let i=this._getCalendars();if(i&&i.length>1){let s=e[t],n=this._mthMode()?wijmo_1.DateTime.addYears:wijmo_1.DateTime.addMonths;"displayMonth"==t&&(s=n(s,-i.indexOf(e)));i[0].deferUpdate(()=>{this._syncing=!0;i.forEach((i,h)=>{if(i!=e){let e=i.displayMonth;i[t]="displayMonth"==t?n(s,h):s;if("value"==t){i.displayMonth=e;this._rngMode()&&(i.rangeEnd=null)}}});this._syncing=!1})}}}_updateContent(){let e=this.displayMonth,t=wijmo_1.Globalize.format,i=wijmo_1.DateTime,s=this._getShowMonthPicker();wijmo_1.setText(this._spMth,t(e,this._fmtYrMo));let n=this._btnMth.querySelector(".wj-glyph-down");n&&(n.style.display=this._mthMode()||!s?"none":"");let h=wijmo_1.closest(this._btnTdy,".wj-btn-group");h&&(h.style.display=s?"":"none");let o=null!=this._fdw?this._fdw:wijmo_1.Globalize.getFirstDayOfWeek(),l=i.addDays(e,-(e.getDay()-o+7)%7),a=i.monthLast(e),r=this._tbMth.querySelectorAll("td");for(let e=0;e<7&&e<r.length;e++){let s=i.addDays(l,e);wijmo_1.setText(r[e],t(s,this._fmtDayHdr))}let _=this._tbMth.querySelectorAll("tr");for(let e=1;e<_.length;e++)wijmo_1.removeChild(_[e]);let d=i.addDays(l,-7*this._wksBefore);for(let e=0;e<this._wksBefore;e++)d=this._addWeek(d,"wj-week-before");for(;d<=a;)d=this._addWeek(d);for(let e=0;e<this._wksAfter;e++)d=this._addWeek(d,"wj-week-after");(r=this._tbYr.querySelectorAll("td")).length&&wijmo_1.setText(r[0],t(e,this._fmtYr));for(let s=1;s<r.length;s++){d=i.newDate(e.getFullYear(),s-1,1);let n=r[s],h=!this._monthInValidRange(d);n[Calendar._DATE_KEY]=d;wijmo_1.setText(n,t(d,this._fmtMonths));wijmo_1.toggleClass(n,"wj-state-disabled",h)}}_updateSelection(){let e=Calendar._DATE_KEY,t=wijmo_1.DateTime,i=this._tbMth.querySelectorAll("td");for(let s=7;s<i.length;s++){let n=i[s],h=n[e],o=this.value,l=this.rangeEnd,a=this._selMode&&t.sameDate(h,o),r=this._selMode&&t.sameDate(h,l),_=this._selMode&&h>o&&null!=l&&h<=l;wijmo_1.toggleClass(n,"wj-state-selected",a);wijmo_1.toggleClass(n,"wj-state-multi-selected",_);wijmo_1.toggleClass(n,"wj-state-last-selected",r);wijmo_1.setAttribute(n,"aria-selected",!!a||null);this._customizeCell(s,h,n)}i=this._tbYr.querySelectorAll("td");for(let t=0;t<i.length;t++){let s=i[t],n=s[e],h=this._sameMonth(n,this.value);wijmo_1.toggleClass(s,"wj-state-selected",h);wijmo_1.setAttribute(s,"aria-selected",!!h||null)}}_addWeek(e,t){let i=this._createElement("tr",this._tbMth,t),s=wijmo_1.DateTime;for(let t=0;t<7;t++){let n=this._createElement("td",i),h=s.addDays(e,t);n[Calendar._DATE_KEY]=h;wijmo_1.setText(n,wijmo_1.Globalize.format(h,this._fmtDay));let o=!this._valid(h),l=h.getDay(),a=h.getMonth()!=this.displayMonth.getMonth();wijmo_1.toggleClass(n,"wj-day-today",s.sameDate(h,s.newDate()));wijmo_1.toggleClass(n,"wj-day-weekend",0==l||6==l);wijmo_1.toggleClass(n,"wj-day-othermonth",a||!this._inValidRange(h)||o);wijmo_1.toggleClass(n,"wj-state-invalid",o)}return s.addDays(e,7)}_customizeCell(e,t,i){wijmo_1.isFunction(this.itemFormatter)&&this.itemFormatter(t,i);if(this.formatItem.hasHandlers){let s=new FormatItemEventArgs(e,t,i);this.onFormatItem(s)}}_canChangeValue(){return!this._readOnly&&this._selMode!=DateSelectionMode.None}_valid(e){return!(!wijmo_1.isDate(e)||!wijmo_1.DateTime.sameDate(e,this._clamp(e)))&&(!wijmo_1.isFunction(this.itemValidator)||this.itemValidator(e))}_inValidRange(e){let t=wijmo_1.DateTime.fromDateTime;return!(this.min&&e<t(this.min,e))&&!(this.max&&e>t(this.max,e))}_monthInValidRange(e){if(this.min||this.max){let t=e.getFullYear(),i=e.getMonth(),s=wijmo_1.DateTime,n=s.newDate(t,i,1),h=s.newDate(t,i+1,0);if(this.min&&this.min>h)return!1;if(this.max&&this.max<n)return!1}return!0}_sameMonth(e,t){return wijmo_1.isDate(e)&&wijmo_1.isDate(t)&&e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()}_getValidDate(e,t){if(wijmo_1.isDate(e)){let i=e.getFullYear(),s=e.getMonth()+(t?0:1),n=t?1:0,h=wijmo_1.DateTime,o=h.newDate(i,s,n),l=t?1:-1;for(let e=0;e<31;e++){if(this._valid(o))return o;o=h.addDays(o,l)}}return null}_clamp(e){if(e){let t=wijmo_1.DateTime.fromDateTime;if(this.min){let i=t(this.min,e);e<i&&(e=i)}if(this.max){let i=t(this.max,e);e>i&&(e=i)}}return e}_createChildren(){let e=this.getTemplate();this.applyTemplate("wj-control wj-calendar",e,{_tbHdr:"tbl-header",_btnMth:"btn-month",_spMth:"span-month",_btnPrv:"btn-prev",_btnTdy:"btn-today",_btnNxt:"btn-next",_tbMth:"tbl-month",_tbYr:"tbl-year"});this._tbYr.style.display="none";let t=wijmo_1.culture.Calendar.ariaLabels;wijmo_1.setAriaLabel(this._tbMth,t.calendar);wijmo_1.setAriaLabel(this._tbYr,t.calendar);wijmo_1.setAriaLabel(this._btnPrv,t.calendar);wijmo_1.setAriaLabel(this._btnMth,t.monthView);wijmo_1.setAriaLabel(this._btnPrv,t.prvMo);wijmo_1.setAriaLabel(this._btnTdy,t.today);wijmo_1.setAriaLabel(this._btnNxt,t.nxtMo);let i=this._createElement("tr",this._tbMth,"wj-header");for(let e=0;e<7;e++)this._createElement("td",i);i=this._createElement("tr",this._tbYr,"wj-header");this._createElement("td",i).setAttribute("colspan","4");for(let e=0;e<3;e++){i=this._createElement("tr",this._tbYr);for(let e=0;e<4;e++)this._createElement("td",i)}}_createYearPicker(){let e=this.hostElement,t=this._createElement("div",null,"wj-dropdown-panel wj-yearpicker");t.tabIndex=this._orgTabIndex;this._lbYears=new ListBox(t,{lostFocus:e=>{wijmo_1.hidePopup(t);this._tmYrHidden=Date.now();this.removeEventListener(window,"touchstart");if(e.selectedIndex>-1){let t=wijmo_1.DateTime.clone(this.displayMonth);t.setFullYear(e.selectedIndex+e.itemsSource[0]);this.displayMonth=t}}});this.addEventListener(t,"keydown",t=>{switch(t.keyCode){case wijmo_1.Key.Enter:e.focus();break;case wijmo_1.Key.Escape:this._lbYears.selectedIndex=-1;e.focus()}t.defaultPrevented&&t.stopPropagation()});this.addEventListener(t,"click",t=>{e.focus()})}_createElement(e,t,i){let s=document.createElement(e);i&&wijmo_1.addClass(s,i);t&&t.appendChild(s);return s}_click(e){if(!e.defaultPrevented&&0==e.button){let o=!1,l=e.target;if(wijmo_1.contains(this._btnMth,l)&&!this._mthMode()&&this._getShowMonthPicker()){this.monthView=!this.monthView;o=!0}else if(wijmo_1.contains(this._btnPrv,l)){this._navigate(-1);o=!0}else if(wijmo_1.contains(this._btnNxt,l)){this._navigate(1);o=!0}else if(wijmo_1.contains(this._btnTdy,l)){this._navigate(0);o=!0}if(l&&!o&&this._yrPicker&&wijmo_1.contains(this._tbYr,l)&&wijmo_1.closest(l,".wj-header")){if(Date.now()-this._tmYrHidden<600){e.preventDefault();return}for(var t=this.displayMonth.getFullYear(),i=this.min?this.min.getFullYear():t-100,s=this.max?this.max.getFullYear():t+100,n=[],h=i;h<=s;h++)n.push(h);let o=this._lbYears,a=o.hostElement,r=wijmo_1.closest(l,".wj-header"),_=this.hostElement,d=wijmo_1.closest(_,".wj-inputdate-dropdown")||_;o.itemsSource=n;o.selectedIndex=t-n[0];wijmo_1.setAttribute(a,"dir",this.rightToLeft?"rtl":null);wijmo_1.setCss(a,{minWidth:"",width:r.offsetWidth});wijmo_1.showPopup(a,r,!1,!1,d);requestAnimationFrame(()=>{o.showSelection(!0)});this.addEventListener(window,"touchstart",e=>{if(!wijmo_1.contains(a,e.target)){wijmo_1.hidePopup(a);this._tmYrHidden=Date.now();this.removeEventListener(window,"touchstart")}});e.preventDefault();return}if(l&&!o){let e=wijmo_1.closest(l,"td");if(e){let t=this.hitTest(e),i=wijmo_1.DateTime.fromDateTime;if(this.monthView){if(t&&this._canChangeValue()){let e=i(t,this._value);this._inValidRange(e)&&this._valid(e)&&(this._rngMode()&&this.value&&!this.rangeEnd&&e>=this.value?this.rangeEnd=e:this.value=e);o=!0}}else if(t){this.displayMonth=t;if(this._mthMode()){if(this._canChangeValue()){let e=i(this.displayMonth,this.value);this._inValidRange(e)&&(this.value=e)}}else this.monthView=!0;o=!0}}}if(o){e.preventDefault();this.focus()}}}_keydown(e){if(e.defaultPrevented)return;if(e.altKey)switch(e.keyCode){case wijmo_1.Key.Up:case wijmo_1.Key.Down:return;case wijmo_1.Key.End:this._navigate(0);e.preventDefault();return}if(e.ctrlKey||e.metaKey||e.shiftKey&&!this._rngMode())return;let t=this._getKeyCode(e),i=0,s=0,n=!0;if(this.monthView)switch(t){case wijmo_1.Key.Left:i=-1;break;case wijmo_1.Key.Right:i=1;break;case wijmo_1.Key.Up:i=-7;break;case wijmo_1.Key.Down:i=7;break;case wijmo_1.Key.PageDown:s=e.altKey?12:1;break;case wijmo_1.Key.PageUp:s=e.altKey?-12:-1;break;case wijmo_1.Key.Home:case wijmo_1.Key.End:if(this._canChangeValue()&&!e.shiftKey){let e=this.value||this.displayMonth,i=this._getValidDate(e,t==wijmo_1.Key.Home);if(i){this.value=wijmo_1.DateTime.fromDateTime(i,this.value);this._rngEnd=null}}break;default:n=!1}else switch(t){case wijmo_1.Key.Left:s=-1;break;case wijmo_1.Key.Right:s=1;break;case wijmo_1.Key.Up:s=-4;break;case wijmo_1.Key.Down:s=4;break;case wijmo_1.Key.PageDown:s=e.altKey?120:12;break;case wijmo_1.Key.PageUp:s=e.altKey?-120:-12;break;case wijmo_1.Key.Home:s=this.value?-this.value.getMonth():0;break;case wijmo_1.Key.End:s=this.value?11-this.value.getMonth():0;break;case wijmo_1.Key.Enter:this._mthMode()?n=!1:this.monthView=!0;break;default:n=!1}if(this._canChangeValue()&&(i||s)){let t=e.shiftKey&&null!=this.rangeEnd?this.rangeEnd:this.value,n=wijmo_1.DateTime;if(t){t=n.addDays(t,i);t=n.addMonths(t,s)}else t=this._getValidDate(new Date,!0);if(s&&!this._valid(t)){let e=t.getMonth();for(let i=1;i<31&&!this._valid(t);i++){let s=n.addDays(t,+i),h=n.addDays(t,-i);this._valid(s)&&s.getMonth()==e?t=s:this._valid(h)&&h.getMonth()==e&&(t=h)}}for(let e=0;e<31&&!this._valid(t);e++)t=n.addDays(t,i>0||s>0?1:-1);e.shiftKey&&t>this.value?this.rangeEnd=t:this.value=t}n&&e.preventDefault()}_getMonth(e){let t=wijmo_1.DateTime;e=e||t.newDate();return t.newDate(e.getFullYear(),e.getMonth(),1)}_mthMode(){return this.selectionMode==DateSelectionMode.Month}_rngMode(){return this.selectionMode==DateSelectionMode.Range}_navigate(e){let t=this.monthView,i=this.displayMonth,s=wijmo_1.DateTime;switch(e){case 0:let e=s.newDate();this._canChangeValue()&&(this.value=t?s.fromDateTime(e,this.value):this._getMonth(e));i=this._getMonth(e);break;case 1:i=s.addMonths(i,t?1:12);break;case-1:i=s.addMonths(i,t?-1:-12)}this.displayMonth=i}}Calendar._DATE_KEY="$WJ-DATE";Calendar.controlTemplate='<div class="wj-content wj-calendar-outer"><div wj-part="tbl-header" class="wj-calendar-header"><div wj-part="btn-month" class="wj-month-select" role="button"><span wj-part="span-month"></span> <span class="wj-glyph-down"></span></div><div class="wj-btn-group"><button wj-part="btn-prev" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-left"></span></button><button wj-part="btn-today" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-circle"></span></button><button wj-part="btn-next" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-right"></span></button></div></div><table wj-part="tbl-month" class="wj-calendar-month" role="grid"></table><table wj-part="tbl-year" class="wj-calendar-year" role="grid"></table></div>';exports.Calendar=Calendar;wijmo_1._addCultureInfo("DropDown",{ariaLabels:{tgl:"Toggle Dropdown"}});!function(e){e[e.Select=0]="Select";e[e.Open=1]="Open";e[e.Toggle=2]="Toggle"}(ClickAction=exports.ClickAction||(exports.ClickAction={}));class DropDown extends wijmo_1.Control{constructor(e,t){super(e);this._clickAction=ClickAction.Select;this._showBtn=!0;this._autoExpand=!0;this._animate=!1;this._oldText="";this.textChanged=new wijmo_1.Event;this.isDroppedDownChanging=new wijmo_1.Event;this.isDroppedDownChanged=new wijmo_1.Event;let i=this.getTemplate();this.applyTemplate("wj-control wj-content wj-dropdown",i,{_tbx:"input",_btn:"btn",_dropDown:"dropdown"},"input");this._dropDown.style.display="none";let s=wijmo_1.culture.DropDown.ariaLabels;wijmo_1.setAriaLabel(this._btn.querySelector("button"),s.tgl);let n=this._elRef=this._tbx;wijmo_1.disableAutoComplete(n);this._createDropDown();this._updateBtn();let h=this.hostElement;wijmo_1.addClass(h,"wj-state-collapsed");this.addEventListener(window,"resize",()=>{this.isDroppedDown&&this.invalidate()});let o=this.dropDown,l=this.addEventListener.bind(this),a=this._updateFocusState.bind(this);l(o,"blur",a,!0);l(o,"focus",a);let r=this._keydown.bind(this);l(h,"keydown",r);l(o,"keydown",r);let _=this._keypress.bind(this);l(h,"keypress",_,!0);l(o,"keypress",_,!0);l(n,"input",()=>{this._setText(this.text,!1)});l(n,"blur",()=>{this._commitText()},!0);l(n,"click",()=>{this._autoExpand&&this._expandSelection()});l(n,"mousedown",e=>{switch(this._clickAction){case ClickAction.Open:if(!this.isDroppedDown){e.preventDefault();this.focus();this.isDroppedDown=!0}break;case ClickAction.Toggle:e.preventDefault();this.focus();this.isDroppedDown=!this.isDroppedDown}});l(this._btn,"mousedown",e=>{this._btnclick(e)});wijmo_1.removeChild(o);wijmo_1.isIE()&&this._elRef==this._tbx&&l(h,"mouseup",e=>{if(!e.defaultPrevented&&0==e.button&&wijmo_1.hasClass(e.target,"wj-btn")){let t=wijmo_1.getActiveElement();t&&t!=e.target&&setTimeout(()=>{t.focus()})}});wijmo_1.isIE9()&&l(n,"keyup",()=>{this._setText(this.text,!1)});l(o,"click",this._dropDownClick.bind(this))}get text(){return this._tbx.value}set text(e){if(e!=this.text){this._setText(e,!0);this._commitText()}}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(e){this._tbx.type=wijmo_1.asString(e)}get isReadOnly(){return this._tbx.readOnly}set isReadOnly(e){this._tbx.readOnly=wijmo_1.asBoolean(e);wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}get isRequired(){return this._tbx.required}set isRequired(e){this._tbx.required=wijmo_1.asBoolean(e)}get placeholder(){return this._tbx.placeholder}set placeholder(e){this._tbx.placeholder=e}get clickAction(){return this._clickAction}set clickAction(e){this._clickAction=wijmo_1.asEnum(e,ClickAction)}get isDroppedDown(){let e=this._dropDown;return e&&"none"!=e.style.display}set isDroppedDown(e){let t=this.hostElement,i=this._dropDown,s=this.containsFocus();if(t&&i&&(e=wijmo_1.asBoolean(e)&&!this.isDisabled&&!this.isReadOnly&&t.offsetWidth>0)!=this.isDroppedDown&&this.onIsDroppedDownChanging(new wijmo_1.CancelEventArgs)){if(e){this._minWidthDropdown=i.style.minWidth;i.style.display="";this._updateDropDown();this.addEventListener(window,"touchstart",e=>{for(let i=e.target;i;){if(i==t)return;i=i[wijmo_1.Control._OWNR_KEY]||i.parentNode}wijmo_1.Control._touching=!0;this.isDroppedDown=!1;wijmo_1.Control._touching=!1})}else{this.removeEventListener(window,"touchstart");wijmo_1.hidePopup(i);i.style.minWidth=this._minWidthDropdown}s&&(this.isTouching&&this.showDropDownButton?t.focus():this.selectAll());this._updateFocusState();wijmo_1.toggleClass(t,"wj-state-collapsed",!this.isDroppedDown);this.onIsDroppedDownChanged()}}get dropDown(){return this._dropDown}get dropDownCssClass(){return this._cssClass}set dropDownCssClass(e){if(e!=this._cssClass){wijmo_1.removeClass(this._dropDown,this._cssClass);this._cssClass=wijmo_1.asString(e);wijmo_1.addClass(this._dropDown,this._cssClass)}}get showDropDownButton(){return this._showBtn}set showDropDownButton(e){this._showBtn=wijmo_1.asBoolean(e);this._updateBtn()}get autoExpandSelection(){return this._autoExpand}set autoExpandSelection(e){this._autoExpand=wijmo_1.asBoolean(e)}get isAnimated(){return this._animate}set isAnimated(e){this._animate=wijmo_1.asBoolean(e)}selectAll(){let e=this._tbx;this._elRef==e&&wijmo_1.setSelectionRange(e,0,this.text.length);this.containsFocus()||this.focus()}onTextChanged(e){this.textChanged.raise(this,e);this._updateState()}onIsDroppedDownChanging(e){this.isDroppedDownChanging.raise(this,e);return!e.cancel}onIsDroppedDownChanged(e){this.isDroppedDownChanged.raise(this,e)}onGotFocus(e){this.isTouching||wijmo_1.contains(this._dropDown,wijmo_1.getActiveElement())||this.selectAll();super.onGotFocus(e)}onLostFocus(e){this._commitText();this.isDroppedDown=!1;super.onLostFocus(e)}containsFocus(){return super.containsFocus()||this.isDroppedDown&&wijmo_1.contains(this._dropDown,wijmo_1.getActiveElement())}dispose(){this.isDroppedDown=!1;let e=this._dropDown;if(e){let t=wijmo_1.Control.getControl(e);t&&t.dispose();wijmo_1.removeChild(e);this._dropDown=null}super.dispose()}refresh(e=!0){super.refresh(e);let t=this.hostElement;if(t&&t.offsetHeight&&this.isDroppedDown){let e=wijmo_1.getActiveElement();this.isAnimated&&""!=this._dropDown.style.opacity||wijmo_1.showPopup(this._dropDown,t,!1,!1,null==this.dropDownCssClass);e instanceof HTMLElement&&e!=wijmo_1.getActiveElement()&&e.focus()}}_handleResize(){this.isDroppedDown&&this.refresh()}_dropDownClick(e){e.stopPropagation()}_expandSelection(){let e=this._tbx,t=e.value,i=e.selectionStart,s=e.selectionEnd;if(t&&i==s){let n=this._getCharType(t,i);if(n>-1){for(;s<t.length&&this._getCharType(t,s)==n;s++);for(;i>0&&this._getCharType(t,i-1)==n;i--);i!=s&&wijmo_1.setSelectionRange(e,i,s)}}}_getCharType(e,t){let i=e[t];return i>="0"&&i<="9"?0:i>="a"&&i<="z"||i>="A"&&i<="Z"?1:-1}_keydown(e){if(!e.defaultPrevented&&!this._isHiddenEditor()){switch(e.keyCode){case wijmo_1.Key.Tab:case wijmo_1.Key.Escape:case wijmo_1.Key.Enter:if(this.isDroppedDown){this.isDroppedDown=!1;e.keyCode==wijmo_1.Key.Tab||this.containsFocus()||this.focus();e.preventDefault()}break;case wijmo_1.Key.F4:case wijmo_1.Key.Up:case wijmo_1.Key.Down:if(e.keyCode==wijmo_1.Key.F4||e.altKey){let t=this.hostElement;if(t&&t.offsetHeight){this.isDroppedDown=!this.isDroppedDown;e.preventDefault()}}}if(!e.defaultPrevented&&e.keyCode==wijmo_1.Key.Escape&&wijmo_1.isIE()){let t=this._tbx;if(e.target==t){let e=t.value;t.value=e+" ";t.value=e}}}}_isHiddenEditor(){return wijmo_1.hasClass(this._tbx,"wj-grid-ime")}_keypress(e){"AltLeft"!=e.code&&"AltRight"!=e.code||e.preventDefault()}_btnclick(e){if(!e.defaultPrevented&&0==e.button){e.preventDefault();this.focus();this.isDroppedDown=!this.isDroppedDown}}_setText(e,t){(e=(e||"").toString())!=this._tbx.value&&(this._tbx.value=e);if(e!=this._oldText){this._oldText=e;this.onTextChanged()}this._updateState()}_updateBtn(){this._btn.style.display=this._showBtn?"":"none"}_createDropDown(){}_commitText(){}_updateDropDown(){if(this.isDroppedDown){this._commitText();let e=this.dropDown;wijmo_1.setAttribute(e,"dir",this.rightToLeft?"rtl":null);wijmo_1.showPopup(e,this.hostElement,!1,this._animate,null==this.dropDownCssClass)}}}DropDown.controlTemplate='<div class="wj-template"><div class="wj-input"><div class="wj-input-group wj-input-btn-visible"><input wj-part="input" type="text" class="wj-form-control"><span wj-part="btn" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-down"></span></button></span></div></div><div wj-part="dropdown" class="wj-content wj-dropdown-panel"></div></div>';exports.DropDown=DropDown;!function(e){e[e.None=0]="None";e[e.ClickOwner=1]="ClickOwner";e[e.ClickPopup=2]="ClickPopup";e[e.Click=3]="Click";e[e.BlurOwner=4]="BlurOwner";e[e.BlurPopup=8]="BlurPopup";e[e.Blur=12]="Blur";e[e.ClickOrBlur=15]="ClickOrBlur";e[e.DownOwner=16]="DownOwner";e[e.DownPopup=32]="DownPopup";e[e.Down=48]="Down";e[e.EnterOwner=64]="EnterOwner";e[e.EnterPopup=128]="EnterPopup";e[e.Enter=192]="Enter";e[e.LeaveOwner=256]="LeaveOwner";e[e.LeavePopup=512]="LeavePopup";e[e.Leave=768]="Leave"}(PopupTrigger=exports.PopupTrigger||(exports.PopupTrigger={}));!function(e){e[e.None=0]="None";e[e.Left=1]="Left";e[e.Top=2]="Top";e[e.Right=4]="Right";e[e.Bottom=8]="Bottom";e[e.LeftTop=3]="LeftTop";e[e.RightTop=6]="RightTop";e[e.RightBottom=12]="RightBottom";e[e.LeftBottom=9]="LeftBottom"}(_Edges||(_Edges={}));class Popup extends wijmo_1.Control{constructor(e,t){super(e);this._owner=null;this._modal=!1;this._position=wijmo_1.PopupPosition.BelowLeft;this._showTrigger=PopupTrigger.ClickOwner;this._hideTrigger=PopupTrigger.Blur;this._hideAnim=[];this._fadeIn=!0;this._fadeOut=!0;this._removeOnHide=!0;this._draggable=!1;this._resizable=!1;this._result=null;this._resultEnter=null;this._resultSubmit=null;this._callback=null;this._visible=!1;this._ownerClickBnd=this._ownerClick.bind(this);this._ownerDownBnd=this._ownerDown.bind(this);this._ownerBlurBnd=this._ownerBlur.bind(this);this._ownerEnterBnd=this._ownerEnter.bind(this);this._ownerLeaveBnd=this._ownerLeave.bind(this);this._mousedownBnd=this._mousedown.bind(this);this._mousemoveBnd=this._mousemove.bind(this);this._mousedragBnd=this._mousedrag.bind(this);this._mouseupBnd=this._mouseup.bind(this);this._hideBnd=this.hide.bind(this);this._lastShow=0;this.showing=new wijmo_1.Event;this.shown=new wijmo_1.Event;this.hiding=new wijmo_1.Event;this.hidden=new wijmo_1.Event;this.resizing=new wijmo_1.Event;this.resized=new wijmo_1.Event;this.dragging=new wijmo_1.Event;this.dragged=new wijmo_1.Event;this.sizeChanging=new wijmo_1.Event;this.sizeChanged=new wijmo_1.Event;this.positionChanging=new wijmo_1.Event;this.positionChanged=new wijmo_1.Event;let i=this.hostElement;wijmo_1.addClass(i,"wj-control wj-content wj-popup");i.getAttribute("tabindex")||(i.tabIndex=0);let s=this.addEventListener.bind(this);s(i,"compositionstart",()=>{this._composing=!0});s(i,"compositionend",()=>{this._composing=!1});s(window,"resize",()=>{!this.isVisible||this._dragged||this.isTouching||this.invalidate()});s(i,"keydown",e=>{if(!e.defaultPrevented){if(e.keyCode==wijmo_1.Key.Escape&&!this._composing){let t=this._oldFocus;e.preventDefault();this.hide();!this.isVisible&&t&&t.offsetHeight&&t.focus()}if(e.keyCode==wijmo_1.Key.Enter&&!this._composing){let t=this.dialogResultEnter;if(t){e.preventDefault();this._validateAndHide(t)}}if(e.keyCode==wijmo_1.Key.Tab&&this.modal){e.preventDefault();wijmo_1.moveFocus(i,e.shiftKey?-1:1)}}});s(i,"click",e=>{let t=e.target;if(t instanceof HTMLElement){if(t instanceof HTMLButtonElement&&"submit"==t.type){let t=this.hostElement,i=this.dialogResultSubmit;if(t instanceof HTMLFormElement&&i&&t.reportValidity()){e.preventDefault();this.hide(i)}}let i=t.className.match(/\bwj-hide[\S]*\b/);if(i&&i.length>0){e.preventDefault();e.stopPropagation();this.hide(i[0])}}});let n=this._toggle.bind(this),h=PopupTrigger;this.addEventListener(i,"click",e=>{this._ignoreClick||n(e,h.ClickPopup)},!0);this.addEventListener(i,"mousedown",e=>{this._ignoreClick=!1;n(e,h.DownPopup)},!0);this.addEventListener(i,"mouseenter",e=>{e.target==i&&n(e,h.EnterPopup)},!0);this.addEventListener(i,"mouseleave",e=>{e.target==i&&n(e,h.LeavePopup)},!0);this.addEventListener(i,"blur",e=>{this.containsFocus()||n(e,h.BlurPopup)},!0);s(document,"wheel",e=>{if(this.isVisible&&this._modal){for(let t=e.target;t&&t!=document.body;t=t.parentElement)if(t.scrollHeight>t.clientHeight)return;e.preventDefault()}});this.initialize(t);wijmo_1.hidePopup(i,this.removeOnHide,!1)}get owner(){return this._owner}set owner(e){let t=this._owner;if(t){this.removeEventListener(t,"click");this.removeEventListener(t,"mousedown");this.removeEventListener(t,"mouseenter");this.removeEventListener(t,"mouseleave");this.removeEventListener(t,"blur")}if(t=this._owner=null!=e?wijmo_1.getElement(e):null){this.addEventListener(t,"click",this._ownerClickBnd,!0);this.addEventListener(t,"mousedown",this._ownerDownBnd,!0);this.addEventListener(t,"mouseenter",this._ownerEnterBnd,!0);this.addEventListener(t,"mouseleave",this._ownerLeaveBnd,!0);this.addEventListener(t,"blur",this._ownerBlurBnd,!0)}}get position(){return this._position}set position(e){this._position=wijmo_1.asEnum(e,wijmo_1.PopupPosition)}get content(){return this.hostElement.firstElementChild}set content(e){if(e!=this.content){this.hostElement.innerHTML="";e instanceof HTMLElement&&this.hostElement.appendChild(e)}}get showTrigger(){return this._showTrigger}set showTrigger(e){this._showTrigger=wijmo_1.asEnum(e,PopupTrigger)}get hideTrigger(){return this._hideTrigger}set hideTrigger(e){this._hideTrigger=wijmo_1.asEnum(e,PopupTrigger)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=wijmo_1.asBoolean(e)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=wijmo_1.asBoolean(e)}get removeOnHide(){return this._removeOnHide}set removeOnHide(e){if((e=wijmo_1.asBoolean(e))!=this.removeOnHide){this._removeOnHide=e;if(!this.isVisible){let t=this.hostElement;if(e)wijmo_1.removeChild(t);else if(t&&document.body){t.style.display="none";document.body.appendChild(t)}}}}get modal(){return this._modal}set modal(e){this._modal=wijmo_1.asBoolean(e)}get isDraggable(){return this._draggable}set isDraggable(e){this._draggable=wijmo_1.asBoolean(e)}get isResizable(){return this._resizable}set isResizable(e){this._resizable=wijmo_1.asBoolean(e)}get dialogResult(){return this._result}set dialogResult(e){this._result=e}get dialogResultEnter(){return this._resultEnter}set dialogResultEnter(e){this._resultEnter=e}get dialogResultSubmit(){return this._resultSubmit}set dialogResultSubmit(e){this._resultSubmit=wijmo_1.asString(e)}get isVisible(){let e=this.hostElement;return this._visible&&null!=e&&e.offsetHeight>0}show(e,t){this._lastShow=Date.now();if(!this.isVisible){let i=this.hostElement;this.dialogResult=null;this._callback=null;this._oldFocus=null;this._myFocus=null;this._hideAnim.forEach(e=>{clearInterval(e)});this._hideAnim.length=0;let s=new wijmo_1.CancelEventArgs;if(this.onShowing(s)){null!=e&&(this.modal=wijmo_1.asBoolean(e));null!=t&&(this._callback=wijmo_1.asFunction(t));this._oldFocus=wijmo_1.getActiveElement();wijmo_1.showPopup(i,this._owner,this._position,this._fadeIn,!1,this._hideBnd);this._modal&&this._showBackdrop();this._composing=!1;this._visible=!0;this.onShown(s);this._clearTimeouts();if(this.modal){this.addEventListener(window,"focus",()=>{if(!this.containsFocus()){let e=this._myFocus;e&&e.offsetHeight?e.focus():wijmo_1.moveFocus(i,0)}});this.addEventListener(i,"focusin",()=>{let e=wijmo_1.getActiveElement();e&&wijmo_1.contains(i,e)&&(e.tabIndex>-1||!this._myFocus)&&(this._myFocus=e)})}this._resized=this._dragged=this._ignoreClick=!1;this._handleDragResize(!0);this.addEventListener(window,"touchstart",e=>{this._hideTrigger&PopupTrigger.Blur&&!wijmo_1.contains(i,e.target,!0)&&this.hide()});setTimeout(()=>{if(!this.containsFocus()&&!this.isTouching){let e=i.querySelector("[autofocus]");if(e&&e.clientHeight>0&&!e.disabled&&e.tabIndex>-1&&!wijmo_1.closest(e,"[disabled],.wj-state-disabled")){e.focus();wijmo_1.isFunction(e.select)&&e.select()}else wijmo_1.moveFocus(i,0)}if(!this.containsFocus()){i.tabIndex=0;i.focus()}},100)}}}hide(e){this._handleDragResize(!1);this.removeEventListener(window,"touchstart");if(this.isVisible){wijmo_1.isUndefined(e)||(this.dialogResult=e);let t=new wijmo_1.CancelEventArgs,i=this.hostElement;if(this.onHiding(t)){let e=i.querySelectorAll(".wj-control.wj-dropdown");for(let t=0;t<e.length;t++){let i=wijmo_1.Control.getControl(e[t]);i instanceof DropDown&&(i.isDroppedDown=!1)}let s=this.removeOnHide,n=this.fadeOut;this._bkDrop&&this._hideAnim.push(wijmo_1.hidePopup(this._bkDrop,s,n));this._hideAnim.push(wijmo_1.hidePopup(i,s,n));this._visible=!1;this._oldFocus=null;this._myFocus=null;this.removeEventListener(window,"focus");this.removeEventListener(i,"focusin");this.containsFocus()&&wijmo_1.getActiveElement().blur();setTimeout(()=>{this._updateState();this.onHidden(t);this._callback&&this._callback(this);if(this.hideTrigger&PopupTrigger.LeavePopup){let e=wijmo_1.Control.getControl(wijmo_1.closest(this.owner,".wj-popup"));if(e instanceof Popup&&0!=(e.hideTrigger&PopupTrigger.Leave)){let t=Popup._evtHover,i=t?document.elementFromPoint(t.clientX,t.clientY):null,s=wijmo_1.Control.getControl(wijmo_1.closest(i,".wj-popup"));s instanceof Popup&&!s.isVisible&&(i=null);i&&wijmo_1.contains(e.hostElement,i,!0)||e.hide()}}});this._clearTimeouts()}}}onShowing(e){this.showing.raise(this,e);return!e.cancel}onShown(e){this.shown.raise(this,e)}onHiding(e){this.hiding.raise(this,e);return!e.cancel}onHidden(e){this._wasVisible=!1;this.hidden.raise(this,e)}onResizing(e){this.resizing.raise(this,e);return!e.cancel}onResized(e){this.resized.raise(this,e)}onDragging(e){this.dragging.raise(this,e);return!e.cancel}onDragged(e){this.dragged.raise(this,e)}onSizeChanging(e){this.sizeChanging.raise(this,e);return!e.cancel}onSizeChanged(e){this.sizeChanged.raise(this,e)}onPositionChanging(e){this.positionChanging.raise(this,e);return!e.cancel}onPositionChanged(e){this.positionChanged.raise(this,e)}onLostFocus(e){super.onLostFocus(e);if(this._hideTrigger&PopupTrigger.BlurPopup&&!this.containsFocus()){let e=document.createEvent("Event");e.initEvent("blur",!0,!0);this._toggle(e,PopupTrigger.BlurPopup)}}dispose(){this.owner=null;super.dispose()}refresh(e=!0){let t=this.hostElement;super.refresh(e);if(this.isVisible&&!this._refreshing&&t){this._refreshing=!0;let e=wijmo_1.getActiveElement(),i=this._owner?this._owner.getBoundingClientRect():null,s=[],n=t.querySelectorAll(".wj-dropdown");for(let e=0;e<n.length;e++){let t=wijmo_1.Control.getControl(n[e]);if(t instanceof DropDown&&t.isDroppedDown){s.push(t);t.dropDown.style.display="none"}}wijmo_1.showPopup(t,i,this._position);s.forEach(e=>{e.dropDown.style.display="";e._updateDropDown()});this._modal&&e instanceof HTMLElement&&e!=wijmo_1.getActiveElement()&&e.focus();this._refreshing=!1}}_clearTimeouts(){if(this._toShow){clearTimeout(this._toShow);this._toShow=null}if(this._toHideLeave){clearTimeout(this._toHideLeave);this._toHideLeave=null}if(this._toHideBlur){clearTimeout(this._toHideBlur);this._toHideBlur=null}}_handleDragResize(e){let t=this.hostElement,i=this._draggable?this._getHeaderElement():null,s=this.addEventListener.bind(this),n=this.removeEventListener.bind(this),h=this._mousemoveBnd,o=this._mousedownBnd;if(e){s(t,"mousemove",h);s(t,"mousedown",o);s(t,"touchstart",o);i&&(i.style.touchAction="none")}else{this._mousedownEvt=null;this._rcBounds=null;n(t,"mousemove",h);n(t,"mousedown",o);n(t,"touchstart",o);n(document,"mousemove",this._mousedragBnd);n(document,"mouseup",this._mouseupBnd);i&&(i.style.touchAction="")}}_mousemove(e){if(!this._mousedownEvt){let t=this.hostElement,i=this._getEdges(t,e),s="",n=_Edges;this._edges=i;this._resizable&&(i==n.LeftTop||i==n.RightBottom?s="nwse-resize":i==n.LeftBottom||i==n.RightTop?s="nesw-resize":i==n.Left||i==n.Right?s="ew-resize":i!=n.Top&&i!=n.Bottom||(s="ns-resize"));this._draggable&&!s&&this._getClosestHeader(e.target)&&(s="move");t.style.cursor=s}}_mousedown(e){if(!e.defaultPrevented){let t=e.touches&&e.touches.length>0?e.touches[0]:e;this._edges=this._getEdges(this.hostElement,t);if(this._edges||this._draggable&&this._getClosestHeader(e.target)){let e=new wijmo_1.CancelEventArgs;if(this._edges?this.onResizing(e):this.onDragging(e)){this._mousedownEvt=t;this._rcBounds=this.hostElement.getBoundingClientRect();let e=this.addEventListener.bind(this),i=document,s=this._mousedragBnd,n=this._mouseupBnd;e(i,"mousemove",s);e(i,"touchmove",s);e(i,"mouseup",n);e(i,"touchend",n)}}this._ignoreClick=!1}}_mouseup(){this._mousedownEvt=null;this._rcBounds=null;let e=this.removeEventListener.bind(this),t=document,i=this._mousedragBnd,s=this._mouseupBnd;e(t,"mousemove",i);e(t,"touchmove",i);e(t,"mouseup",s);e(t,"touchend",s);this._resized?this.onResized():this._dragged&&this.onDragged()}_mousedrag(e){if(!e.defaultPrevented){let t=this.hostElement,i=this._mousedownEvt,s=e.touches&&e.touches.length>0?e.touches[0]:e,n=s.clientX-i.clientX,h=s.clientY-i.clientY,o=this._rcBounds,l=this._edges,a=Popup._SZ_MIN,r=wijmo_1.Rect.fromBoundingRect(o);if(l){if(l&_Edges.Left){r.left=o.left+n+(s.pageX-s.clientX);r.width=Math.max(o.width-n,a)}else if(l&_Edges.Right){r.left=o.left;r.width=Math.max(o.width+n,a)}if(l&_Edges.Top){r.top=o.top+h+(s.pageY-s.clientY);r.height=Math.max(o.height-h,a)}else if(l&_Edges.Bottom){r.top=o.top;r.height=Math.max(o.height+h,a)}if(this.onSizeChanging(new PopupBoundsChangingEventArgs(r))){wijmo_1.setCss(t,{left:r.left,top:r.top,width:r.width,height:r.height});this._resized=this._dragged=this._ignoreClick=!0;this.onSizeChanged()}if(!window.ResizeObserver){let e=this.hostElement.children;for(let t=0;t<e.length;t++)wijmo_1.Control.invalidateAll(e[t])}}else if(this._draggable&&(this._dragged||Math.abs(n)+Math.abs(h)>Popup._DRAG_THRESHOLD)){r.left=Math.max(o.left+n+(s.pageX-s.clientX),50-o.width);r.top=Math.max(o.top+h+(s.pageY-s.clientY),0);if(this.onPositionChanging(new PopupBoundsChangingEventArgs(r))){wijmo_1.setCss(t,{left:r.left,top:r.top});this._dragged=this._ignoreClick=!0;this.onPositionChanged()}}}}_getEdges(e,t){let i=0;if(this._resizable){let s=e.getBoundingClientRect(),n=Popup._SZ_EDGE;t.clientX-s.left<n&&(i|=_Edges.Left);t.clientY-s.top<n&&(i|=_Edges.Top);s.right-t.clientX<n&&(i|=_Edges.Right);s.bottom-t.clientY<n&&(i|=_Edges.Bottom)}return i}_ownerClick(e){this._toggle(e,PopupTrigger.ClickOwner)}_ownerDown(e){this._wasVisible=this.isVisible;this._toggle(e,PopupTrigger.DownOwner)}_ownerBlur(e){wijmo_1.contains(this._owner,wijmo_1.getActiveElement())||this._toggle(e,PopupTrigger.BlurOwner)}_ownerEnter(e){e.target==this._owner&&this._toggle(e,PopupTrigger.EnterOwner)}_ownerLeave(e){e.target==this._owner&&this._toggle(e,PopupTrigger.LeaveOwner)}_toggle(e,t){e instanceof MouseEvent&&(Popup._evtHover=e);if(!("mouseenter"==e.type&&Date.now()-this._lastShow<300||e.defaultPrevented)){let e=0!=(this._hideTrigger&t),i=0!=(this._showTrigger&t),s=PopupTrigger;(e||i)&&this._clearTimeouts();e&&this.isVisible&&(t&s.Leave?this._toHideLeave=setTimeout(()=>{let e=Popup._evtHover,t=e?document.elementFromPoint(e.clientX,e.clientY):null;t&&wijmo_1.contains(this.hostElement,t,!0)||this.hide()},wijmo_1.Control._LEAVE_DELAY):t&s.Blur?this._toHideBlur=setTimeout(()=>{this.containsFocus()||wijmo_1.contains(this._owner,wijmo_1.getActiveElement())||this.hide()},wijmo_1.Control._FOCUS_INTERVAL+50):this.hide());i&&t!=s.ClickPopup&&(this._wasVisible||(t&s.Enter?this._toShow=setTimeout(()=>{this.show()},wijmo_1.Control._HOVER_DELAY):this.show()))}}_getHeaderElement(){let e=this.hostElement;return e.querySelector(".wj-dialog-header")||e.querySelector(".modal-header")}_getClosestHeader(e){return wijmo_1.closest(e,".wj-dialog-header")||wijmo_1.closest(e,".modal-header")}_showBackdrop(){if(!this._bkDrop){this._bkDrop=document.createElement("div");this._bkDrop.tabIndex=-1;wijmo_1.addClass(this._bkDrop,"wj-popup-backdrop");this.addEventListener(this._bkDrop,"mousedown",e=>{e.preventDefault();e.stopPropagation();this.hostElement.focus();this.hideTrigger&PopupTrigger.Blur&&this.hide()})}wijmo_1.setCss(this._bkDrop,{zIndex:wijmo_1.Control._POPUP_ZINDEX,display:""});let e=this.hostElement;e.parentElement.insertBefore(this._bkDrop,e)}_validateAndHide(e){let t=this.hostElement;if(t instanceof HTMLFormElement)t.reportValidity()&&this.hide(e);else{let t=this.hostElement.querySelector(":invalid");t?t.focus():this.hide(e)}}}Popup._DRAG_THRESHOLD=6;Popup._SZ_EDGE=10;Popup._SZ_MIN=40;exports.Popup=Popup;class PopupBoundsChangingEventArgs extends wijmo_1.CancelEventArgs{constructor(e){super();this._rc=e}get bounds(){return this._rc}}exports.PopupBoundsChangingEventArgs=PopupBoundsChangingEventArgs;class InputDate extends DropDown{constructor(e,t){super(e);this._fmt="d";this._sep=" - ";this._rngs=null;this._showCal=!1;this._clsOnSel=!0;this._clicked=!1;this.valueChanged=new wijmo_1.Event;this.rangeEndChanged=new wijmo_1.Event;wijmo_1.addClass(this.hostElement,"wj-inputdate");this._msk=new wijmo_1._MaskProvider(this._tbx);wijmo_1.isIE9()||(this.inputType="tel");this._tbx.type.match(/^(tel|text|)$/i)||(this.inputType="text");this.addEventListener(this.hostElement,"wheel",e=>{if(!e.defaultPrevented&&!this.isDroppedDown&&this.containsFocus()&&null!=this.value&&this._canChangeValue()){let t=wijmo_1.clamp(-e.deltaY,-1,1),i=this.value;this.value=this.selectionMode==DateSelectionMode.Month?wijmo_1.DateTime.addMonths(i,t):wijmo_1.DateTime.addDays(i,t);this.selectAll();e.preventDefault()}});let i=this._lbx=new ListBox(document.createElement("div"),{displayMemberPath:"name",selectedIndexChanged:e=>{let t=e.selectedItem,i=wijmo_1.DateTime.fromDateTime;if(t&&t.from&&t.to){let e=this.value;this.value=i(t.from,e);this.rangeEnd=i(t.to,e);this._selectAll()}else this._cal.hostElement.style.display=""}}),s=this._cal=new Calendar(document.createElement("div")),n=this._dropDown;wijmo_1.addClass(n,"wj-inputdate-dropdown");n.appendChild(i.hostElement);n.appendChild(s.hostElement);this.addEventListener(n,"click",()=>{this._clicked=!0;setTimeout(()=>{this._clicked=!1},50)},!0);if("INPUT"==this._orgTag){let e=this._tbx.getAttribute("value");e&&(s.value=s.rangeEnd=wijmo_1.Globalize.parseDate(e,"yyyy-MM-dd"))}this.isRequired=!0;this.initialize(t);this._tbx.value=this._oldText=this._getText();this._updateState();s.valueChanged.addHandler((e,t)=>{this.onValueChanged(t);this._closeOnChange();this._refreshText()});s.rangeEndChanged.addHandler((e,t)=>{if(s._rngMode()){this.onRangeEndChanged(t);this._closeOnChange();s._clearingRangeEnd||this._refreshText()}});s.hostElement.addEventListener("click",e=>{if(s.selectionMode&&!s._rngMode()){let t=e.target,i=s.hitTest(t);(wijmo_1.DateTime.sameDate(this.value,i)||wijmo_1.closest(t,"[wj-part=btn-today]"))&&this._closeOnChange()}})}get value(){return this._cal.value}set value(e){this._cal.value=e}get rangeEnd(){return this._cal.rangeEnd}set rangeEnd(e){this._cal.rangeEnd=e}get rangeMin(){return this._cal.rangeMin}set rangeMin(e){this._cal.rangeMin=e}get rangeMax(){return this._cal.rangeMax}set rangeMax(e){this._cal.rangeMax=e}get text(){return this._tbx.value}set text(e){if(e!=this.text){this._setText(e,!0);this._commitText()}}get format(){return this._fmt}set format(e){if(e!=this.format){this._fmt=wijmo_1.asString(e);this._refreshText()}}get separator(){return this._sep}set separator(e){if(e!=this._sep){this._sep=wijmo_1.asString(e,!1);this.invalidate()}}get mask(){return this._msk.mask}set mask(e){this._msk.mask=wijmo_1.asString(e)}get closeOnSelection(){return this._clsOnSel}set closeOnSelection(e){this._clsOnSel=wijmo_1.asBoolean(e)}get predefinedRanges(){return this._rngs}set predefinedRanges(e){if(this._rngs!=e){wijmo_1.assert(null==e||wijmo_1.isObject(e),"Object expected");this._rngs=e;this._lbx.itemsSource=this._getRanges(e);this.invalidate()}}get alwaysShowCalendar(){return this._showCal}set alwaysShowCalendar(e){this._showCal=wijmo_1.asBoolean(e)}get min(){return this._cal.min}set min(e){this._cal.min=wijmo_1.asDate(e,!0)}get max(){return this._cal.max}set max(e){this._cal.max=wijmo_1.asDate(e,!0)}get repeatButtons(){return this._cal.repeatButtons}set repeatButtons(e){this._cal.repeatButtons=wijmo_1.asBoolean(e)}get showYearPicker(){return this._cal.showYearPicker}set showYearPicker(e){this._cal.showYearPicker=wijmo_1.asBoolean(e)}get showMonthPicker(){return this._cal.showMonthPicker}set showMonthPicker(e){this._cal.showMonthPicker=e}get showHeader(){return this._cal.showHeader}set showHeader(e){this._cal.showHeader=e}get weeksBefore(){return this._cal.weeksBefore}set weeksBefore(e){this._cal.weeksBefore=e}get weeksAfter(){return this._cal.weeksAfter}set weeksAfter(e){this._cal.weeksAfter=e}get selectionMode(){return this._cal.selectionMode}set selectionMode(e){if(e!=this.selectionMode){this._cal.selectionMode=e;this.invalidate()}}get monthCount(){return this._cal.monthCount}set monthCount(e){this._cal.monthCount=e}get calendar(){return this._cal}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(e){this._tbx.type=wijmo_1.asString(e)}get itemValidator(){return this._cal.itemValidator}set itemValidator(e){if(e!=this.itemValidator){this._cal.itemValidator=wijmo_1.asFunction(e);this.invalidate()}}get itemFormatter(){return this._cal.itemFormatter}set itemFormatter(e){this._cal.itemFormatter=wijmo_1.asFunction(e)}onValueChanged(e){this.valueChanged.raise(this,e)}onRangeEndChanged(e){this.rangeEndChanged.raise(this,e)}refresh(e=!0){super.refresh(e);if(this.hostElement){this._msk&&this._msk.refresh();this._cal&&this._cal.refresh();this._refreshText()}}onIsDroppedDownChanging(e){if(this.isDroppedDown){let e=this._cal;e._rngMode()&&e.value&&!e.rangeEnd&&(e.rangeEnd=e.value)}else{let e=this._lbx,t=this._cal,i=e.collectionView,s=e.hostElement.style,n=t.hostElement.style;if(t._rngMode()&&wijmo_1.hasItems(i)){let e=this._updateRangeSelection();s.display="";n.display=!this._showCal&&e&&e.from&&i.items.some(e=>!e.to)?"none":""}else{s.display="none";n.display=""}t._mthMode()||(t.monthView=!0)}return super.onIsDroppedDownChanging(e)}onIsDroppedDownChanged(e){super.onIsDroppedDownChanged(e);let t=this.containsFocus();if(this.isDroppedDown){t&&(this._tryFocus(this._cal)||this._tryFocus(this._lbx)||this.dropDown.focus());this._lbx.showSelection();this._cal.refresh()}else this._commitText()}_updateDropDown(){this._commitText();let e=getComputedStyle(this.hostElement);this._dropDown.style.minWidth=18*parseFloat(e.fontSize)+"px";this._cal.refresh();super._updateDropDown()}_keydown(e){if(!(e.defaultPrevented||e.altKey||e.ctrlKey||e.metaKey)){if(this._isHiddenEditor())return;switch(e.keyCode){case wijmo_1.Key.Enter:this._commitText();break;case wijmo_1.Key.Escape:this.text=this._getText();this.selectAll();break;case wijmo_1.Key.Tab:if(this._cal._rngMode()){let t=this._tbx,i=this._sep,s=t.value,n=s.indexOf(i);if(n>-1){let h=s.length,o=t.selectionStart,l=t.selectionEnd,a=null;t.selectionEnd<=n&&!e.shiftKey?a=0==o&&0==l:e.shiftKey&&t.selectionStart>=n+i.length&&(a=o<h||l<h);if(null!=a){a?wijmo_1.setSelectionRange(t,0,n):wijmo_1.setSelectionRange(t,n+i.length,h);e.preventDefault()}}}break;case wijmo_1.Key.Up:case wijmo_1.Key.Down:if(!this.isDroppedDown&&this.value&&this._canChangeValue()){let t=e.keyCode==wijmo_1.Key.Up?1:-1,i=this.selectionMode==DateSelectionMode.Month?wijmo_1.DateTime.addMonths(this.value,t):wijmo_1.DateTime.addDays(this.value,t);this.value=this._fromDateTime(i);this.selectAll();e.preventDefault()}}}super._keydown(e)}_expandSelection(){if(this._cal._rngMode()){let e=this._tbx,t=e.value,i=e.selectionStart,s=e.selectionEnd,n=this._sep,h=t.indexOf(n);h>-1&&i==s&&(s<=h?wijmo_1.setSelectionRange(e,0,h):i>=h+n.length&&wijmo_1.setSelectionRange(e,h+n.length,e.value.length))}else super._expandSelection()}_refreshText(){let e=this._getText();if(e!=this.text){this._tbx.value=this._oldText=e;this.onTextChanged()}}_selectAll(){this.isDroppedDown||!this.containsFocus()||this.isTouching||this.selectAll()}_closeOnChange(){if(this._clsOnSel&&this._clicked){let e=this._cal;(!e._rngMode()||e.value&&e.rangeEnd)&&setTimeout(()=>{this.isDroppedDown=!1})}}_tryFocus(e){let t=e.hostElement;if(t&&t.offsetHeight){t.focus();return!0}return!1}_clamp(e){return this._cal._clamp(e)}_getText(){let e=wijmo_1.Globalize.format,t=this._fmt,i=e(this.value,t);this._cal._rngMode()&&i&&(i+=this._sep+e(this.rangeEnd,t));return i}_commitText(){let e=this._tbx.value;if(e!=this._getText()){let t=!1,i=this._fmt,s=this._cal,n=wijmo_1.Globalize.parseDate;if(e||this.isRequired)if(s._rngMode()){let h=e.split(this._sep);if(2==h.length&&h[0]){let e=n(h[0],i,this.value);if(e){let o=n(h[1],i,this.value);s.value=this._fromDateTime(e);s.rangeEnd=o&&o>=e?this._fromDateTime(o):e;t=!0}}}else{let s=n(e,i,this.value);if(s){this.value=this._fromDateTime(s);t=!0}}else this.value=this.rangeEnd=null;(t||this.onInvalidInput(new wijmo_1.CancelEventArgs))&&(this.text=this._getText())}this._selectAll()}_fromDateTime(e){return wijmo_1.DateTime.fromDateTime(e,this.value)}_canChangeValue(){return!this.isReadOnly&&!this.isDisabled&&this.selectionMode!=DateSelectionMode.None}_isValidDate(e){if(e){if(this._clamp(e)!=e)return!1;if(this.itemValidator&&!this.itemValidator(e))return!1}return!0}_getRanges(e){let t=[];if(wijmo_1.isObject(e))for(let i in e){let s=e[i];t.push({name:i,from:s?s[0]:null,to:s?s[1]:null})}return new wijmo_1.CollectionView(t,{currentItem:null})}_updateRangeSelection(){let e=this._lbx,t=-1;if(wijmo_1.hasItems(e.collectionView)){let e=this._lbx.collectionView.items,i=wijmo_1.DateTime.sameDate;for(let s=0;s<e.length;s++){let n=e[s];if(n.from){if(i(n.from,this.value)&&i(n.to,this.rangeEnd)){t=s;break}}else t=s}}e.selectedIndex=t;return e.selectedItem}}exports.InputDate=InputDate;class InputDateRange extends InputDate{constructor(e,t){super(e,{selectionMode:DateSelectionMode.Range,showMonthPicker:"Outside",monthCount:2});wijmo_1.addClass(this.hostElement,"wj-inputdaterange");this.initialize(t)}get selectionMode(){return this.calendar.selectionMode}set selectionMode(e){e=wijmo_1.asEnum(e,DateSelectionMode);wijmo_1.assert(e==DateSelectionMode.Range,'InputDateRange.selectionMode must be "Range"');this.calendar.selectionMode=e}}exports.InputDateRange=InputDateRange;class InputColor extends DropDown{constructor(e,t){super(e);this.valueChanged=new wijmo_1.Event;wijmo_1.addClass(this.hostElement,"wj-inputcolor");this._ePreview=wijmo_1.createElement('<div class="wj-inputcolorbox"></div>',this.hostElement.firstElementChild);if("INPUT"==this._orgTag){this._tbx.type="";this._commitText()}this.value="#ffffff";this.isRequired=!0;this.initialize(t);this.addEventListener(this._colorPicker.hostElement,"click",e=>{let t=e.target;if(t&&"DIV"==t.tagName&&(wijmo_1.closest(t,'[wj-part="div-pal"]')||wijmo_1.closest(t,'[wj-part="div-pv"]'))){t.style.backgroundColor&&(this.isDroppedDown=!1)}})}get value(){return this._value}set value(e){this.text=e}get text(){return this._tbx.value}set text(e){if((e=wijmo_1.asString(e))!=this.text&&(e||!this.isRequired)&&(!e||wijmo_1.Color.fromString(e))){this._setText(e,!0);this._commitText()}}get showAlphaChannel(){return this._colorPicker.showAlphaChannel}set showAlphaChannel(e){this._colorPicker.showAlphaChannel=e}get showColorString(){return this._colorPicker.showColorString}set showColorString(e){this._colorPicker.showColorString=e}get palette(){return this._colorPicker.palette}set palette(e){this._colorPicker.palette=e}get colorPicker(){return this._colorPicker}onValueChanged(e){this.valueChanged.raise(this,e)}onIsDroppedDownChanged(e){super.onIsDroppedDownChanged(e);this.isDroppedDown&&!this.isTouching&&this.selectAll()}_createDropDown(){this._colorPicker=new ColorPicker(this._dropDown);wijmo_1.setCss(this._dropDown,{minWidth:420,minHeight:200});this._colorPicker.valueChanged.addHandler(()=>{this.value=this._colorPicker.value})}_keydown(e){if(!e.defaultPrevented)switch(e.keyCode){case wijmo_1.Key.Enter:this._commitText();this.selectAll();break;case wijmo_1.Key.Escape:this.text=this.value;this.selectAll()}super._keydown(e)}_commitText(){if(this._value!=this.text){if(!this.isRequired&&!this.text){this._value=this.text;this._ePreview.style.backgroundColor="";this.onValueChanged();return}if(wijmo_1.Color.fromString(this.text)){let e=this._colorPicker;e.value=this.text;this._value=e.value;this._ePreview.style.backgroundColor=this.value;this.onValueChanged()}else this.onInvalidInput(new wijmo_1.CancelEventArgs)&&(this.text=this._value?this._value:"")}}}exports.InputColor=InputColor;class ComboBox extends DropDown{constructor(e,t){super(e);this._editable=!1;this._trimText=!0;this._delKey=0;this._pathHdr=new wijmo_1.Binding(null);this._bsCollapse=!0;this._fmtItemHandlers=0;this.itemsSourceChanged=new wijmo_1.Event;this.selectedIndexChanged=new wijmo_1.Event;let i=this.hostElement;wijmo_1.addClass(i,"wj-combobox");this.dropDown.id=wijmo_1.getUniqueId(i.id+"_dropdown");this.autoExpandSelection=!1;let s=this._tbx;this.addEventListener(s,"compositionstart",()=>{this._composing=!0});this.addEventListener(s,"compositionend",()=>{this._composing=!1;this._setText(this.text,!0)});this.addEventListener(i,"wheel",this._wheel.bind(this));"SELECT"==this._orgTag&&this._lbx._initFromSelect(i);let n=this._lbx;n.loadedItems.addHandler(e=>{this.selectedIndex>-1&&(this.selectedIndex=n.selectedIndex)});this.isRequired=!0;this.initialize(t)}get itemsSource(){return this._lbx.itemsSource}set itemsSource(e){if(this._lbx.itemsSource!=e){this._lbx.itemsSource=e;this.onItemsSourceChanged()}this._updateBtn()}get collectionView(){return this._lbx.collectionView}get showGroups(){return this._lbx.showGroups}set showGroups(e){this._lbx.showGroups=e}get displayMemberPath(){return this._lbx.displayMemberPath}set displayMemberPath(e){this._lbx.displayMemberPath=e;let t=this.getDisplayText();this.text!=t&&this._setText(t,!0)}get headerPath(){return this._pathHdr.path}set headerPath(e){this._pathHdr.path=wijmo_1.asString(e);let t=this.getDisplayText();this.text!=t&&this._setText(t,!0)}get selectedValuePath(){return this._lbx.selectedValuePath}set selectedValuePath(e){this._lbx.selectedValuePath=e}get isContentHtml(){return this._lbx.isContentHtml}set isContentHtml(e){if(e!=this.isContentHtml){this._lbx.isContentHtml=wijmo_1.asBoolean(e);let t=this.getDisplayText();this.text!=t&&this._setText(t,!0)}}get caseSensitiveSearch(){return this._lbx.caseSensitiveSearch}set caseSensitiveSearch(e){this._lbx.caseSensitiveSearch=wijmo_1.asBoolean(e)}get trimText(){return this._trimText}set trimText(e){if(e!=this._trimText){this._trimText=wijmo_1.asBoolean(e);this.invalidate()}}get itemFormatter(){return this._lbx.itemFormatter}set itemFormatter(e){this._lbx.itemFormatter=wijmo_1.asFunction(e);this.selectedIndex=this._lbx.selectedIndex}get formatItem(){return this._lbx.formatItem}get selectedIndex(){return this._lbx.selectedIndex}set selectedIndex(e){e!=this.selectedIndex&&wijmo_1.isNumber(e)&&(this._lbx.selectedIndex=e);e=this.selectedIndex;let t=this.getDisplayText(e);this.text!=t&&this._setText(t,!0)}get selectedItem(){return this._lbx.selectedItem}set selectedItem(e){this._lbx.selectedItem=e}get selectedValue(){return this.collectionView?this._lbx.selectedValue:this.text}set selectedValue(e){this.collectionView?this._lbx.selectedValue=e:null!=e&&(this.text=e.toString())}get isEditable(){return this._editable}set isEditable(e){this._editable=wijmo_1.asBoolean(e)}get maxDropDownHeight(){return this._lbx.maxHeight}set maxDropDownHeight(e){this._lbx.maxHeight=e}get maxDropDownWidth(){let e=this._dropDown,t=e?parseInt(e.style.maxWidth):null;return isNaN(t)?null:t}set maxDropDownWidth(e){let t=this._dropDown.style;e=wijmo_1.asNumber(e,!0);t.maxWidth=null==e?"":e+"px";t.minWidth=""}getDisplayText(e=this.selectedIndex,t=this._trimText){let i,s=this.collectionView;if(this.headerPath&&e>-1&&wijmo_1.hasItems(s)){let t=s.items[e];i=null!=(i=t?this._pathHdr.getValue(t):null)?i.toString():"";this.isContentHtml&&(i=wijmo_1.toPlainText(i))}else i=this._lbx.getDisplayText(e);return t?i.trim():i}indexOf(e,t){let i=this.collectionView,s=this.caseSensitiveSearch;if(wijmo_1.hasItems(i)&&null!=e){e=e.toString();s||(e=e.toLowerCase());let n=this.selectedIndex,h=this.getDisplayText(n);if(t){s||(h=h.toLowerCase());if(e==h)return n}for(let n=0;n<i.items.length;n++)if(this._lbx.isItemEnabled(n)){h=this.getDisplayText(n);s||(h=h.toLowerCase());if(t){if(h==e)return n}else if(e&&0==h.indexOf(e))return n}}return-1}get listBox(){return this._lbx}onItemsSourceChanged(e){this.itemsSourceChanged.raise(this,e)}onSelectedIndexChanged(e){this._updateBtn();this.selectedIndexChanged.raise(this,e)}refresh(e=!0){super.refresh(e);if(this.hostElement&&wijmo_1.hasItems(this.collectionView)){this._lbx.refresh();this.selectedIndex>-1&&(this.selectedIndex=this._lbx.selectedIndex)}}onLostFocus(e){if(this._composing){this._composing=!1;this._setText(this.text,!0)}this.isEditable&&this.isRequired&&!this.text&&wijmo_1.hasItems(this.collectionView)&&(this.selectedIndex=0);super.onLostFocus(e)}onIsDroppedDownChanging(e){if(!this.isDroppedDown&&!this._hasItems()){e.cancel=!0;return!1}return super.onIsDroppedDownChanging(e)}onIsDroppedDownChanged(e){super.onIsDroppedDownChanged(e);if(this.isDroppedDown){this._fmtItemHandlers=this.formatItem.handlerCount;this._lbx.showSelection()}this._updateAria()}_updateBtn(){let e=this.collectionView,t=this._tbx,i=this._hasItems();super._updateBtn();this._btn.style.display=this._showBtn&&null!=e?"":"none";wijmo_1.enable(this._btn,i);wijmo_1.setAttribute(t,"role",i?"combobox":null);wijmo_1.setAttribute(t,"aria-autocomplete",i?"both":null);this._updateAria()}_hasItems(){return wijmo_1.hasItems(this.collectionView)}_updateAria(){let e=this._tbx,t=this.isDroppedDown,i=this.dropDown?this.dropDown.id:null,s=i&&wijmo_1.hasItems(this.collectionView);wijmo_1.setAttribute(e,"aria-owns",s&&t?i:null);wijmo_1.setAttribute(e,"aria-expanded",s?t:null)}_createDropDown(){this._lbx||(this._lbx=new ListBox(this._dropDown));this._lbx.maxHeight=200;this._lbx.selectedIndexChanged.addHandler(()=>{this._updateBtn();let e=this._lbx.selectedIndex,t=this._lbx.hostElement.children,i=e>-1&&e<t.length?t[e].id:null;wijmo_1.setAttribute(this._tbx,"aria-activedescendant",i&&i.length?i:null);this.selectedIndex=e;this.onSelectedIndexChanged()});this._lbx.itemsChanged.addHandler(()=>{this._updateBtn()})}_wheel(e){if(!e.defaultPrevented&&!this.isDroppedDown&&!this.isReadOnly&&this.containsFocus()&&this.selectedIndex>-1){let t=this._findNext("",e.deltaY>0?1:-1);t>-1&&(this.selectedIndex=t);e.preventDefault()}}_dropDownClick(e){e.defaultPrevented||e.target!=this._dropDown&&(this.isDroppedDown=!1);super._dropDownClick(e)}_setText(e,t){if(this._composing)return;if(this._settingText)return;this._settingText=!0;if(this.containsFocus()){let e=this.formatItem.handlerCount;if(this._fmtItemHandlers!=e){this._fmtItemHandlers=e;this._lbx.loadList()}}null==e&&(e="");e=e.toString();let i=this.selectedIndex,s=this.collectionView,n=this._getSelStart(),h=-1,o=!0;if(this.isEditable&&(this._delKey||this._getSelEnd()<e.length||!this.containsFocus())){t=!0;o=!1}i=this.indexOf(e,t);if(o){i<0&&t&&(i=this.indexOf(e,!1));i<0&&n>0&&(i=this.indexOf(e.substr(0,n),!1))}if(i<0&&!this.isEditable&&wijmo_1.hasItems(s)&&(this.isRequired||e)){let t=this._oldText||"";i=Math.max(0,this.indexOf(t,!1));for(let i=0;i<e.length&&i<t.length;i++)if(e[i]!=t[i]){n=i;break}}if(i>-1){h=n;e=this.getDisplayText(i)}let l=this._tbx;e!=l.value&&(l.value=e);h>-1&&this.containsFocus()&&!this.isTouching&&this._updateInputSelection(h);s&&s.moveCurrentToPosition(i);this._delKey=0;this._settingText=!1;super._setText(e,t)}_findNext(e,t,i=this.selectedIndex){let s=this.collectionView,n=s?s.items.length:0,h=this._lbx,o=this.caseSensitiveSearch;if(s&&n&&t){o||(e=e.toLowerCase());for(let s=i+t;s>-1&&s<n;s+=t){let t=this.getDisplayText(s);o||(t=t.toLowerCase());if(0==t.indexOf(e)){if(!this.dropDown.children[s]||h.isItemEnabled(s))return s}}}return i}_keydown(e){super._keydown(e);if(e.defaultPrevented||this.isReadOnly)return;if(e.altKey)return;if(!wijmo_1.hasItems(this.collectionView))return;if(this._elRef!=this._tbx)return;if(this._isHiddenEditor())return;this._delKey=0;let t=this._getSelStart();switch(e.keyCode){case wijmo_1.Key.Back:if(this._bsCollapse&&!this.isEditable){let e=this._getSelEnd();t>0&&e==this._tbx.value.length&&wijmo_1.hasItems(this.collectionView)&&this._setSelRange(t-1,e)}this._delKey=e.keyCode;break;case wijmo_1.Key.Delete:this._delKey=e.keyCode;break;case wijmo_1.Key.Up:case wijmo_1.Key.Down:t==this.text.length&&(t=0);this.selectedIndex=this._findNext(this.text.substr(0,t),e.keyCode==wijmo_1.Key.Up?-1:1);this._setSelRange(t,this.text.length);e.preventDefault();break;case wijmo_1.Key.PageUp:this._lbx._selectPrevPage();this.selectAll();e.preventDefault();break;case wijmo_1.Key.PageDown:this._lbx._selectNextPage();this.selectAll();e.preventDefault()}}_updateInputSelection(e){let t=this._tbx;this._elRef==t&&this._setSelRange(e,t.value.length)}_getSelStart(){let e=this._tbx;return e&&e.value?e.selectionStart:0}_getSelEnd(){let e=this._tbx;return e&&e.value?e.selectionEnd:0}_setSelRange(e,t){let i=this._tbx;this._elRef!=i||i.readOnly||wijmo_1.setSelectionRange(i,e,t)}}exports.ComboBox=ComboBox;wijmo_1._addCultureInfo("MultiSelect",{itemsSelected:"{count:n0} items selected",selectAll:"Select All"});class MultiSelect extends ComboBox{constructor(e,t){super(e);this._maxHdrItems=2;this._readOnly=!1;this._hdrFmt=null;this.checkedItemsChanged=new wijmo_1.Event;wijmo_1.addClass(this.hostElement,"wj-multiselect");this._tbx.readOnly=!0;this.checkedMemberPath=null;this.removeEventListener(this.dropDown,"click");this._lbx.itemsChanged.addHandler(()=>{this._updateHeader()});this._lbx.checkedItemsChanged.addHandler(()=>{this._updateHeader();this.onCheckedItemsChanged()});this.clickAction=ClickAction.Toggle;this.initialize(t)}get showSelectAllCheckbox(){return this._msLbx.showSelectAllCheckbox}set showSelectAllCheckbox(e){this._msLbx.showSelectAllCheckbox=wijmo_1.asBoolean(e)}get showFilterInput(){return this._msLbx.showFilterInput}set showFilterInput(e){this._msLbx.showFilterInput=wijmo_1.asBoolean(e)}get delay(){return this._msLbx.delay}set delay(e){this._msLbx.delay=e}get caseSensitiveSearch(){return this._msLbx.caseSensitiveSearch}set caseSensitiveSearch(e){this._msLbx.caseSensitiveSearch=e}get filterInputPlaceholder(){return this._msLbx.filterInputPlaceholder}set filterInputPlaceholder(e){this._msLbx.filterInputPlaceholder=wijmo_1.asString(e)}get checkOnFilter(){return this._msLbx.checkOnFilter}set checkOnFilter(e){if(e!=this.checkOnFilter){this._msLbx.checkOnFilter=wijmo_1.asBoolean(e);this.checkedItems=[]}}get selectAllLabel(){return this._msLbx.selectAllLabel}set selectAllLabel(e){this._msLbx.selectAllLabel=wijmo_1.asString(e)}get checkedMemberPath(){return this._msLbx.checkedMemberPath}set checkedMemberPath(e){this._msLbx.checkedMemberPath=wijmo_1.asString(e)}get maxHeaderItems(){return this._maxHdrItems}set maxHeaderItems(e){if(this._maxHdrItems!=e){this._maxHdrItems=wijmo_1.asNumber(e);this._updateHeader()}}get headerFormat(){return this._hdrFmt}set headerFormat(e){if(e!=this._hdrFmt){this._hdrFmt=wijmo_1.asString(e);this._updateHeader()}}get headerFormatter(){return this._hdrFormatter}set headerFormatter(e){if(e!=this._hdrFormatter){this._hdrFormatter=wijmo_1.asFunction(e);this._updateHeader()}}get checkedItems(){return this._msLbx.checkedItems}set checkedItems(e){this._msLbx.checkedItems=wijmo_1.asArray(e);this._updateHeader()}onCheckedItemsChanged(e){this.checkedItemsChanged.raise(this,e)}dispose(){this._lbx.dispose();super.dispose()}onIsDroppedDownChanged(e){super.onIsDroppedDownChanged(e);setTimeout(()=>{if(this.isDroppedDown&&this.containsFocus())if(this.showFilterInput&&!this.isTouching)this._msLbx._filter.focus();else{let e=this.listBox;if(e.selectedIndex<0){let t=0,i=e.checkedItems;i.length&&(t=e.collectionView.items.indexOf(i[0]));e.selectedIndex=Math.max(0,t)}e.showSelection(!0);e.focus()}})}_createDropDown(){let e=wijmo_1.createElement("<div></div>",this._dropDown);this._msLbx=new MultiSelectListBox(e);this._lbx=this._msLbx.listBox;super._createDropDown()}get isReadOnly(){return this._readOnly}set isReadOnly(e){this._readOnly=wijmo_1.asBoolean(e);wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}refresh(e=!0){super.refresh(e);this.hostElement&&this._updateHeader()}_setText(e,t){}_keydown(e){super._keydown(e);wijmo_1.hasClass(this._tbx,"wj-grid-ime")||!e.defaultPrevented&&wijmo_1.hasItems(this.collectionView)&&e.keyCode>32&&(this.isDroppedDown=!0)}_hasItems(){let e=this.collectionView,t=e?e.sourceCollection:null;return wijmo_1.hasItems(e)||t&&t.length&&this.showFilterInput}_updateHeader(){let e="";if(wijmo_1.isFunction(this._hdrFormatter))e=this._hdrFormatter(this);else{let t=this.checkedItems;if(t.length>0)if(t.length<=this._maxHdrItems){if(this.headerPath){let e=new wijmo_1.Binding(this.headerPath);t=t.map(t=>e.getValue(t))}else if(this.displayMemberPath){let e=new wijmo_1.Binding(this.displayMemberPath);t=t.map(t=>e.getValue(t))}this.isContentHtml&&(t=t.map(e=>wijmo_1.toPlainText(e)));e=t.join(", ")}else e=wijmo_1.format(this.headerFormat||wijmo_1.culture.MultiSelect.itemsSelected,{count:t.length})}let t=this.inputElement;if(e!=t.value){t.value=e;this.onTextChanged()}this._updateState()}}MultiSelect._DEF_CHECKED_PATH="$checked";exports.MultiSelect=MultiSelect;class Menu extends ComboBox{constructor(e,t){super(e);this._closing=!1;this._cmd=null;this._cmdPath=null;this._cmdParamPath=null;this._subPath=null;this._owner=null;this._isButton=!1;this._openOnHover=!1;this._closeOnLeave=!0;this._subMenu=null;this._hoverEnterBnd=this._hoverEnter.bind(this);this._hoverLeaveBnd=this._hoverLeave.bind(this);this._hoverOverBnd=this._hoverOver.bind(this);this.itemClicked=new wijmo_1.Event;let i=this.hostElement,s=this._tbx,n=this._lbx,h=this.dropDown;wijmo_1.addClass(i,"wj-menu");s.style.display="none";this._hdr=this._elRef=wijmo_1.createElement('<div wj-part="header" class="wj-form-control"/>');s.parentElement.insertBefore(this._hdr,this._tbx);var o=this._orgOuter.match(/tabindex="?(-?\d+)"?/i);i.tabIndex=o?parseInt(o[1]):0;this.isRequired=!1;wijmo_1.setAttribute(i,"role","menubar",!0);wijmo_1.setAttribute(s,"role",null);wijmo_1.setAttribute(s,"aria-autocomplete",null);wijmo_1.setAttribute(s,"aria-owns",null);wijmo_1.setAttribute(h,"role","menu");n.itemRole="menuitem";if("SELECT"==this._orgTag){this.header=i.getAttribute("header");this._lbx.itemsSource&&(this.commandParameterPath="cmdParam")}this.isContentHtml=!0;this.maxDropDownHeight=500;this.addEventListener(this._hdr,"click",e=>{if(!e.defaultPrevented){this._clearHover(e);if(this._isButton){this.isDroppedDown=!1;this._raiseCommand()}else this.isDroppedDown=!this.isDroppedDown}});n.lostFocus.addHandler(()=>{this.containsFocus()||(this.isDroppedDown=!1)});wijmo_1.addClass(h,"wj-menu-items");n.formatItem.addHandler(this._formatMenuItem.bind(this));this.initialize(t)}get header(){return this._hdr.innerHTML}set header(e){this._hdr.innerHTML=wijmo_1.asString(e)}get command(){return this._cmd}set command(e){this._cmd=e}get commandPath(){return this._cmdPath}set commandPath(e){this._cmdPath=wijmo_1.asString(e)}get commandParameterPath(){return this._cmdParamPath}set commandParameterPath(e){this._cmdParamPath=wijmo_1.asString(e)}get subItemsPath(){return this._subPath}set subItemsPath(e){if(e!=this._subPath){this._subPath=e;this.refresh(!0)}}get openOnHover(){return this._openOnHover}set openOnHover(e){this._openOnHover=wijmo_1.asBoolean(e);this._updateHoverEvents()}get closeOnLeave(){return this._closeOnLeave}set closeOnLeave(e){this._closeOnLeave=wijmo_1.asBoolean(e);this._updateHoverEvents()}get isButton(){return this._isButton}set isButton(e){this._isButton=wijmo_1.asBoolean(e)}get owner(){return this._owner}set owner(e){this._owner=wijmo_1.asType(e,HTMLElement,!0);this._enableDisableItems()}show(e){if(!this.isDroppedDown){this.selectedIndex=-1;if(this.onIsDroppedDownChanging(new wijmo_1.CancelEventArgs)){let t=this.dropDown,i=this.owner;!i&&e instanceof MouseEvent&&(i=e.target);i instanceof HTMLElement&&(t[wijmo_1.Control._OWNR_KEY]=i);if(e instanceof MouseEvent&&this.openOnHover&&this.closeOnLeave){let t=2;e=new wijmo_1.Point(e.pageX-pageXOffset-t,e.pageY-pageYOffset-t)}wijmo_1.showPopup(t,e,!1,this.isAnimated);this.onIsDroppedDownChanged();t.focus()}}}hide(){if(this.isDroppedDown&&this.onIsDroppedDownChanging(new wijmo_1.CancelEventArgs)){wijmo_1.hidePopup(this.dropDown);this.onIsDroppedDownChanged()}}onItemClicked(e){this.itemClicked.raise(this,e)}refresh(e=!0){super.refresh(e);this.hostElement&&this._enableDisableItems()}onIsDroppedDownChanged(e){super.onIsDroppedDownChanged(e);if(this.isDroppedDown){this._closing=!0;this._defaultItem=this.selectedItem;this.isRequired=!1;this.selectedIndex=-1;this._enableDisableItems();this._closing=!1;this.dropDown.focus()}else{this.selectedItem||(this.selectedItem=this._defaultItem);let e=this._subMenu;e&&(e.isDroppedDown=!1)}}_updateHoverEvents(){let e=this.hostElement,t=this.dropDown,i=this.addEventListener.bind(this),s=this.removeEventListener.bind(this),n="mouseleave";s(e,"mouseenter",this._hoverEnterBnd);s(e,n,this._hoverLeaveBnd);s(t,"mouseover",this._hoverOverBnd);s(t,n,this._hoverLeaveBnd);if(this._openOnHover){i(e,"mouseenter",this._hoverEnterBnd);i(t,"mouseover",this._hoverOverBnd);if(this._closeOnLeave){i(e,n,this._hoverLeaveBnd);i(t,n,this._hoverLeaveBnd)}}}_getSubItems(e){let t=this.subItemsPath,i=e&&t?e[t]:null;return wijmo_1.isArray(i)&&i.length?i:null}_formatMenuItem(e,t){let i=t.item;if(this._getSubItems(t.data))wijmo_1.addClass(i,"wj-subitems");else if("-"==i.innerHTML){i.innerHTML="";wijmo_1.addClass(i,"wj-separator")}}_keydown(e){if(!e.defaultPrevented){let i=this._getKeyCode(e);if(this.isDroppedDown)switch(i){case wijmo_1.Key.Enter:case wijmo_1.Key.Right:if(this._showSubMenu()){e.preventDefault();return}break;case wijmo_1.Key.Left:var t=wijmo_1.Control.getControl(this.owner);if(t instanceof Menu){let i=t.dropDown,s=t.selectedIndex;(s>-1?i.children[s]:i).focus();e.preventDefault();return}}if(i==wijmo_1.Key.Enter)if(this.isDroppedDown)this.selectedIndex>-1&&this._raiseCommand();else{this.isDroppedDown=!0;e.preventDefault()}}super._keydown(e)}_dropDownClick(e){if(!e.defaultPrevented&&e.target!=this.dropDown){this._clearHover(e);if(this._showSubMenu()){e.preventDefault();return}this.selectedIndex>-1&&this._raiseCommand()}super._dropDownClick(e)}_showSubMenu(){let e=this._getSubItems(this.selectedItem);if(!e)return null;let t=this.dropDown.children[this.selectedIndex].getBoundingClientRect(),i=new wijmo_1.Point(t.right,t.top);if(0==t.height)return null;let s=this.rightToLeft||"rtl"==this.dropDown.getAttribute("dir");s&&(i.x=t.left);let n=this._subMenu;n&&(n.isDroppedDown=!1);n=new Menu(document.createElement("div"),{owner:this.hostElement,itemsSource:e,itemClicked:(e,t)=>{this.itemClicked.raise(e,t)}});"displayMemberPath,selectedValuePath,isContentHtml,command,commandPath,commandParameterPath,maxDropDownWidth,maxDropDownHeight,dropDownCssClass,isAnimated,subItemsPath,openOnHover,closeOnLeave".split(",").forEach(e=>{n[e]=this[e]});let h=n.dropDown;wijmo_1.setAttribute(h,"dir",s?"rtl":null);n.show(i);h[wijmo_1.Control._OWNR_KEY]=this.dropDown;h.focus();return n}_raiseCommand(e){let t=this.selectedItem,i=this._getSubItems(t),s=this._getCommand(t);if(s&&!i){let e=this._getCommandParm(t);if(!this._canExecuteCommand(s,e))return;this._executeCommand(s,e)}let n=this.headerPath;if(n){let e=new wijmo_1.Binding(n).getValue(t);e=null==e?"":e.toString();this.header=this.isContentHtml?e:wijmo_1.escapeHtml(e)}this.onItemClicked(e);if(this.containsFocus()){let e=this;for(;e&&e.owner;){let t=wijmo_1.Control.getControl(e.owner);if(!(t instanceof Menu))break;e=t}let t=e.owner;!t&&e.dropDown&&(t=e.dropDown[wijmo_1.Control._OWNR_KEY]);e.isDroppedDown=!1;e.focus();e.containsFocus()||t instanceof HTMLElement&&t.focus()}}_getCommand(e){let t=e&&this._cmdPath?e[this._cmdPath]:null;return t||this._cmd}_getCommandParm(e){let t=this._cmdParamPath;return e&&t?e[t]:e}_executeCommand(e,t){e&&!wijmo_1.isFunction(e)&&(e=e.executeCommand);wijmo_1.isFunction(e)&&e(t)}_canExecuteCommand(e,t){if(e){let i=e.canExecuteCommand;if(wijmo_1.isFunction(i))return i(t)}return!0}_enableDisableItems(){if(this.collectionView&&(this._cmd||this._cmdPath)){let e=this.collectionView.items;for(let t=0;t<e.length;t++){let i=e[t],s=this._getCommand(i);if(s){let e=this._lbx.hostElement.children[t],n=this._getCommandParm(i);wijmo_1.toggleClass(e,"wj-state-disabled",!this._canExecuteCommand(s,n))}}}}_clearHover(e){this._toHover&&clearTimeout(this._toHover);this._toHover=null;Menu._evtHover=e}_hoverEnter(e){this._clearHover(e);this._toHover=setTimeout(()=>{this._toHover=null;this.isDroppedDown=!0},wijmo_1.Control._HOVER_DELAY)}_hoverLeave(e){this._clearHover(e);this.isDroppedDown&&(this._toHover=setTimeout(()=>{let t=(e=Menu._evtHover)?document.elementFromPoint(e.clientX,e.clientY):null,i=wijmo_1.closest(t,".wj-listbox.wj-menu-items"),s=this._subMenu;if(!i&&!wijmo_1.contains(this.hostElement,t,!0)){this.isDroppedDown=!1;s&&(s.isDroppedDown=!1)}},wijmo_1.Control._LEAVE_DELAY))}_hoverOver(e){this._clearHover(e);this._toHover=setTimeout(()=>{this._toHover=null;let t=this.listBox.indexOf(e.target);if(t>-1){this.selectedIndex=t;this._subMenu=this._showSubMenu()}},wijmo_1.Control._HOVER_DELAY)}}exports.Menu=Menu;class InputTime extends ComboBox{constructor(e,t){super(e);this._format="t";this.valueChanged=new wijmo_1.Event;wijmo_1.addClass(this.hostElement,"wj-inputtime");this.isEditable=!0;this._value=wijmo_1.DateTime.newDate();this._min=this._max=null;this._msk=new wijmo_1._MaskProvider(this._tbx);wijmo_1.isIE9()||(this._tbx.type="tel");if("INPUT"==this._orgTag){let e=this._tbx.getAttribute("value");e&&(this.value=wijmo_1.Globalize.parseDate(e,"HH:mm:ss"))}this.step=15;this.autoExpandSelection=!0;this.initialize(t)}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(e){this._tbx.type=wijmo_1.asString(e)}get value(){return this._value}set value(e){(e=wijmo_1.asDate(e,!this.isRequired))&&(e=this._clamp(e));this._setText(e?wijmo_1.Globalize.format(e,this.format):"",!0);this.selectedItem&&this.selectedItem.value&&(e=wijmo_1.DateTime.fromDateTime(e,this.selectedItem.value));if(e!=this._value&&!wijmo_1.DateTime.equals(e,this._value)){this._value=e;this.onValueChanged()}}get text(){return this._tbx.value}set text(e){if(e!=this.text){this._setText(e,!0);this._commitText()}}get min(){return this._min}set min(e){this._min=wijmo_1.asDate(e,!0);this.isDroppedDown=!1;this._updateItems()}get max(){return this._max}set max(e){this._max=wijmo_1.asDate(e,!0);this.isDroppedDown=!1;this._updateItems()}get step(){return this._step}set step(e){if(e!=this.step){this._step=e;this.isDroppedDown=!1;this._updateItems()}}get format(){return this._format}set format(e){if(e!=this.format){this._format=wijmo_1.asString(e);this._tbx.value=wijmo_1.Globalize.format(this.value,this.format);wijmo_1.hasItems(this.collectionView)&&this._updateItems()}}get mask(){return this._msk.mask}set mask(e){this._msk.mask=wijmo_1.asString(e)}onValueChanged(e){this.valueChanged.raise(this,e)}onItemsSourceChanged(e){super.onItemsSourceChanged(e);this._hasCustomItems=null!=this.itemsSource}refresh(e=!0){super.refresh(e);if(this.hostElement){this._msk.refresh();this._tbx.value=wijmo_1.Globalize.format(this.value,this.format);this._updateItems()}}onSelectedIndexChanged(e){if(this.selectedIndex>-1&&!this._settingText){let e=this.value?this.value:wijmo_1.DateTime.newDate(),t=null!=this.selectedItem.value?this.selectedItem.value:wijmo_1.Globalize.parseDate(this.text,this.format,this.value);this.value=wijmo_1.DateTime.fromDateTime(e,t)}super.onSelectedIndexChanged(e)}_clamp(e){null!=this._min&&this._getTime(e)<this._getTime(this._min)&&(e=wijmo_1.DateTime.fromDateTime(e,this._min));null!=this._max&&this._getTime(e)>this._getTime(this._max)&&(e=wijmo_1.DateTime.fromDateTime(e,this._max));return e}_wheel(e){if(!e.defaultPrevented&&!this.isDroppedDown&&!this.isReadOnly&&this.containsFocus()&&this.selectedIndex<0&&this.value&&wijmo_1.isNumber(this.step)&&this.step>0){let t=wijmo_1.DateTime.addMinutes(this.value,this.step*wijmo_1.clamp(e.deltaY,-1,1));this.value=this._clamp(t);this.selectAll();e.preventDefault()}super._wheel(e)}_updateInputSelection(e){if(this._delKey)super._updateInputSelection(e);else{let t=this._tbx.value;for(;e<t.length&&!t[e].match(/[a-z0-9]/i);)e++;wijmo_1.setSelectionRange(this._tbx,e,this._tbx.value.length)}}_updateItems(){if(this._hasCustomItems)return;let e=[],t=wijmo_1.DateTime.newDate(0,0,0,0,0),i=wijmo_1.DateTime.newDate(0,0,0,23,59,59),s=this.step;this.min&&t.setHours(this.min.getHours(),this.min.getMinutes(),this.min.getSeconds());this.max&&i.setHours(this.max.getHours(),this.max.getMinutes(),this.max.getSeconds());if(wijmo_1.isNumber(s)&&s>=1)for(let n=t;n<=i;n=wijmo_1.DateTime.addMinutes(n,s))e.push({value:n,text:wijmo_1.Globalize.format(n,this.format)});let n=this.value;this._settingText=!0;this.displayMemberPath="text";this.selectedValuePath="text";this.itemsSource=e;this._hasCustomItems=!1;this._settingText=!1;!n&&this.isRequired||(this.value=n)}_getTime(e){return 3600*e.getHours()+60*e.getMinutes()+e.getSeconds()}_keydown(e){super._keydown(e);if(!e.defaultPrevented)switch(e.keyCode){case wijmo_1.Key.Enter:if(!this.isDroppedDown){this._commitText();this.selectAll()}break;case wijmo_1.Key.Escape:this.text=wijmo_1.Globalize.format(this.value,this.format);this.selectAll()}}_commitText(){if(this.text||this.isRequired){let e=this.value?wijmo_1.Globalize.format(this.value,this.format):"";if(this.text!=e){let t=this.selectedItem&&this.selectedItem.value?this.selectedItem.value:wijmo_1.Globalize.parseDate(this.text,this.format,this.value);t?(wijmo_1.DateTime.sameTime(t,this._clamp(t))||this.onInvalidInput(new wijmo_1.CancelEventArgs))&&(this.value=wijmo_1.DateTime.fromDateTime(this.value,t)):this.onInvalidInput(new wijmo_1.CancelEventArgs)&&(this.text=e)}}else this.value=null}}exports.InputTime=InputTime;wijmo_1._addCultureInfo("InputDateTime",{ariaLabels:{tglDate:"Toggle Calendar",tglTime:"Toggle Time List"}});class InputDateTime extends InputDate{constructor(e,t){super(e);wijmo_1.addClass(this.hostElement,"wj-inputdatetime");let i=wijmo_1.culture.InputDateTime.ariaLabels;wijmo_1.setAriaLabel(this._btn,i.tglDate);wijmo_1.setAriaLabel(this._btnTm,i.tglTime);this.value=new Date;this.format="g";this._inputTime=new InputTime(document.createElement("div"),{valueChanged:e=>{let t=this.rangeEnd;this.value=wijmo_1.DateTime.fromDateTime(this.value,e.value);this.calendar._rngMode()&&t&&(this.rangeEnd=wijmo_1.DateTime.fromDateTime(t,e.value))}});let s=this.addEventListener.bind(this);this._btnTm=this.hostElement.querySelector('[wj-part="btn-tm"]');s(this._btnTm,"mousedown",e=>{this._btnclick(e)});this._ddDate=this._dropDown;let n=this._ddTime=this._inputTime.dropDown;s(n,"keydown",this._keydown.bind(this),!0);s(n,"blur",()=>{this._updateFocusState()},!0);s(n,"click",e=>{e.defaultPrevented||e.target!=n&&this.hostElement.focus()},!0);this.initialize(t);this.text=this._getText()}get timeMin(){return this._inputTime.min}set timeMin(e){this._inputTime.min=e}get timeMax(){return this._inputTime.max}set timeMax(e){this._inputTime.max=e}get timeFormat(){return this._inputTime.format}set timeFormat(e){this._inputTime.format=e}get timeStep(){return this._inputTime.step}set timeStep(e){this._inputTime.step=e}get inputTime(){return this._inputTime}_fromDateTime(e){return e}_btnclick(e){let t=wijmo_1.closest(e.target,"button")==this._btn?this._ddDate:this._ddTime;this._setDropdown(t);super._btnclick(e)}dispose(){this._setDropdown(this._ddDate);super.dispose();this._inputTime.dispose()}refresh(e=!0){this._inputTime.refresh();super.refresh(e)}_updateBtn(){super._updateBtn();if(this._btnTm){this._btnTm.tabIndex=this._btn.tabIndex;this._btnTm.parentElement.style.display=this._btn.style.display}}_setDropdown(e){if(this._dropDown==e)return!1;this.isDroppedDown&&(this.isDroppedDown=!1);var t=this.dropDownCssClass;this.dropDownCssClass="";this._dropDown=e;this.dropDownCssClass=t;return!0}_updateDropDown(){let e=this._inputTime;if(this._dropDown==e.dropDown){this._commitText();super._updateDropDown();e.isRequired=this.isRequired&&null!=this.value;e.value=this.value;this.isDroppedDown&&e.listBox.showSelection()}else super._updateDropDown()}}InputDateTime.controlTemplate='<div class="wj-template"><div class="wj-input"><div class="wj-input-group wj-input-btn-visible"><input wj-part="input" type="text" class="wj-form-control"/><span class="wj-input-group-btn"><button wj-part="btn" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-calendar"></span></button><button wj-part="btn-tm" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-clock"></span></button></span></div></div><div wj-part="dropdown" class="wj-content wj-dropdown-panel"></div></div>';exports.InputDateTime=InputDateTime;class AutoComplete extends ComboBox{constructor(e,t){super(e);this._cssMatch="wj-state-match";this._minLength=2;this._maxItems=6;this._itemCount=0;this._beginsWith=!1;this._delay=wijmo_1.Control._SEARCH_DELAY;this._query="";this._inCallback=!1;this._srchProps=[];wijmo_1.addClass(this.hostElement,"wj-autocomplete");this._bsCollapse=!1;this.isEditable=!0;this.isRequired=!1;this.listBox.formatItem.addHandler(this._formatListItem,this);this._itemsSourceFnCallbackBnd=this._itemSourceFunctionCallback.bind(this);this.initialize(t)}get minLength(){return this._minLength}set minLength(e){this._minLength=wijmo_1.asNumber(e,!1,!0)}get beginsWithSearch(){return this._beginsWith}set beginsWithSearch(e){this._beginsWith=wijmo_1.asBoolean(e)}get maxItems(){return this._maxItems}set maxItems(e){this._maxItems=wijmo_1.asNumber(e,!1,!0)}get delay(){return this._delay}set delay(e){this._delay=wijmo_1.asNumber(e,!1,!0)}get searchMemberPath(){return this._srchProp}set searchMemberPath(e){this._srchProp=wijmo_1.asString(e);this._srchProps=e?e.trim().split(/\s*,\s*/):[]}get itemsSourceFunction(){return this._itemsSourceFn}set itemsSourceFunction(e){this._itemsSourceFn=wijmo_1.asFunction(e);wijmo_1.isFunction(this._itemsSourceFn)&&this.itemsSourceFunction(this.text,this.maxItems,this._itemsSourceFnCallbackBnd)}get cssMatch(){return this._cssMatch}set cssMatch(e){this._cssMatch=wijmo_1.asString(e)}_keydown(e){if(!e.defaultPrevented&&this.isDroppedDown)switch(e.keyCode){case wijmo_1.Key.Up:case wijmo_1.Key.Down:this.selectAll()}super._keydown(e)}_setText(e){if(!(this._inCallback||this._composing||this._settingText)){if(this.selectedIndex>-1&&this.getDisplayText()!=e){this._settingText=!0;this.selectedIndex=-1;this._settingText=!1}if(e!=this._oldText){let t=this._tbx;t.value!=e&&(t.value=e);this._oldText=e;this.onTextChanged();let i=this.collectionView;if(!e&&i){(this._query||this.selectedIndex<0)&&(this.isDroppedDown=!1);this._query=this._rxHighlight=null;i.filter=null;let e=this.itemsSourceFunction;if(wijmo_1.isFunction(e)){this.isDroppedDown=!1;e(this._query,this.maxItems,this._itemsSourceFnCallbackBnd)}return}}this._toSearch&&clearTimeout(this._toSearch);e!=this.getDisplayText()&&(this._toSearch=setTimeout(()=>{this._toSearch=null;let e=this.text.trim();if(e.length>=this._minLength&&e!=this._query){this._query=e;e=wijmo_1.escapeRegExp(e);let t=wijmo_1.escapeHtml(e),i=this.caseSensitiveSearch?"":"i";this._beginsWith||(i+="g");this._rxSrch=this._beginsWith?new RegExp("^"+e+".*",i):new RegExp("(?=.*"+e.replace(/ /g,")(?=.*")+")",i);this._rxHighlight=new RegExp("("+t.replace(/\s+/g,"|")+")",i);let s=this.itemsSourceFunction;wijmo_1.isFunction(s)?s(this._query,this.maxItems,this._itemsSourceFnCallbackBnd):this._updateItems()}},this._delay))}}_itemSourceFunctionCallback(e){this._inCallback=!0;let t=wijmo_1.asCollectionView(e);t&&t.moveCurrentToPosition(-1);this.itemsSource=t;this._inCallback=!1;if(this.containsFocus()){let e=this._tbx,t=e.selectionStart,i=e.selectionEnd,s=this.collectionView;this.isDroppedDown=null!=s&&s.items.length>0;wijmo_1.setSelectionRange(e,t,i);this.refresh()}}onIsDroppedDownChanged(e){super.onIsDroppedDownChanged(e);if(this.containsFocus()&&!this.isTouching&&this.selectedIndex<0){let e=this.collectionView.items,t=this.text;1==e.length&&e[0]==t?this.selectedIndex=0:wijmo_1.setSelectionRange(this._tbx,t.length)}this._query=""}_updateItems(){let e=this.collectionView;if(e){this._inCallback=!0;e.beginUpdate();this._itemCount=0;e.filter=this._filter.bind(this);e.moveCurrentToPosition(-1);e.endUpdate();this._inCallback=!1;let t=e.items.length,i=this._tbx,s=i.selectionStart,n=i.selectionEnd;this.isDroppedDown=t>0&&this.containsFocus();t||this.isEditable||(this.selectedIndex=-1);this.isDroppedDown&&wijmo_1.setSelectionRange(i,s,n);this.refresh()}}_filter(e){if(this._itemCount>=this._maxItems)return!1;let t=this._getItemText(e,!1);this._srchProps&&this._srchProps.forEach(i=>{let s=e[i];null!=s&&(t+="\0"+s)});this.isContentHtml&&(t=t.replace(/(<[^>]*>|&[^;]*;)/g,""));if(this._rxSrch.test(t)){this._itemCount++;return!0}return!1}_getItemText(e,t){let i=e?e.toString():"",s=t&&this.headerPath?this._pathHdr:this._lbx._pathDisplay;s&&(i=null!=(i=s.getValue(e))?i.toString():"");return i}_formatListItem(e,t){this._cssMatch&&this._rxHighlight&&(t.item.innerHTML=t.item.innerHTML.replace(this._rxHighlight,(e,t,i,s)=>this._enclosed(s,i,"<",">")||this._enclosed(s,i,"&",";")?e:'<span class="'+this._cssMatch+'">'+e+"</span>"))}_enclosed(e,t,i,s){for(let n=t;n>=0&&e[n]!=s;n--)if(e[n]==i)for(let n=t;n<e.length&&e[n]!=i;n++)if(e[n]==s)return!0;return!1}}exports.AutoComplete=AutoComplete;class MultiAutoComplete extends AutoComplete{constructor(e,t){super(e);this._selItems=[];this._maxSelItems=null;this._lastInputValue="";this._selPath=new wijmo_1.Binding(null);this._notAddItm=!1;this.selectedItemsChanged=new wijmo_1.Event;wijmo_1.addClass(this.hostElement,"wj-multi-autocomplete");this._wjTpl=this.hostElement.querySelector(".wj-template");this._wjInput=this.hostElement.querySelector(".wj-input");this.showDropDownButton=!1;this.initialize(t);this.addEventListener(this.hostElement,"keyup",this._keyup.bind(this),!0);this.addEventListener(window,"resize",this._adjustInputWidth.bind(this));this.addEventListener(this._tbx,"focus",()=>{this._itemOff()});this._addHelperInput();this._initSeltems();this.listBox.itemsChanged.addHandler(()=>this.selectedIndex=-1);this._refreshHeader()}set showDropDownButton(e){this._showBtn=!1}get maxSelectedItems(){return this._maxSelItems}set maxSelectedItems(e){if(this._maxSelItems!=e){this._maxSelItems=wijmo_1.asNumber(e,!0);this._updateMaxItems();this._refreshHeader();this._clearSelIndex()}}get selectedMemberPath(){return this._selPath.path}set selectedMemberPath(e){if((e=wijmo_1.asString(e))!==this.selectedMemberPath){this._selPath.path=e;this._initSeltems();this._refreshHeader();this.onSelectedItemsChanged()}}get selectedItems(){return this._selItems}set selectedItems(e){this._selItems=wijmo_1.asArray(e);if(this.selectedMemberPath&&""!==this.selectedMemberPath&&this._selItems)for(let e=0;e<this._selItems.length;e++){let t=this._selItems[e];this._setSelItem(t,!1)}this._updateMaxItems();this.onSelectedItemsChanged();this._refreshHeader();this._clearSelIndex()}onSelectedItemsChanged(e){this.selectedItemsChanged.raise(this,e)}onIsDroppedDownChanged(e){!this.isDroppedDown&&this.selectedIndex>-1&&!this._notAddItm&&this._addItem(!0);this._notAddItm=!1;super.onIsDroppedDownChanged(e)}refresh(e=!0){super.refresh(e);if(this.hostElement){this._initSeltems();this.isDroppedDown||this._refreshHeader()}}_keydown(e){if(!this.isReadOnly){if(!e.defaultPrevented)switch(e.keyCode){case wijmo_1.Key.Back:this._lastInputValue=this._tbx.value;break;case wijmo_1.Key.Enter:this._itemOff();this._addItem(!0);wijmo_1.isIE&&wijmo_1.setSelectionRange(this._tbx,0,0);break;case wijmo_1.Key.Tab:if(this.isDroppedDown){this._addItem(!1);this._tbx.value="";this._lbx.selectedIndex=-1;e.preventDefault()}else this._updateFocus();break;case wijmo_1.Key.Space:if(""!==this._tbx.value)return;if(!this.isDroppedDown&&!this._tbx.disabled){this.isDroppedDown=!0;this._clearSelIndex()}break;case wijmo_1.Key.Escape:this.isDroppedDown&&(this._notAddItm=!0);break;case wijmo_1.Key.Left:this._itemOn(!this.rightToLeft);break;case wijmo_1.Key.Right:this._itemOn(!!this.rightToLeft);break;case wijmo_1.Key.Up:case wijmo_1.Key.Down:let t=wijmo_1.getActiveElement();if(e.altKey){if(this._tbx==t){this.isDroppedDown=!this.isDroppedDown;this.isDroppedDown||this._tbx.focus();e.preventDefault();return}}else if(this._tbx!==t)return;default:if(e.keyCode===wijmo_1.Key.Back||e.keyCode===wijmo_1.Key.Delete)return;this._itemOff();null!=this._maxSelItems&&this._selItems.length>=this._maxSelItems&&e.preventDefault()}this._tbx.disabled||super._keydown(e)}}_updateState(){super._updateState();this._wjTpl&&(wijmo_1.hasClass(this.hostElement,"wj-state-focused")||this._itemOff())}_keyup(e){if(!this.isReadOnly&&!e.defaultPrevented)switch(e.keyCode){case wijmo_1.Key.Back:0===this._tbx.value.length&&0===this._lastInputValue.length&&this._delItem(!1);break;case wijmo_1.Key.Delete:this._delItem(!0)}}_addHelperInput(){let e=document.createElement("input");e.type="text";e.tabIndex=-1;e.className="wj-token-helper";e.readOnly=!0;this._wjTpl.insertBefore(e,this._wjInput);this._helperInput=e}_refreshHeader(){let e=this.hostElement.querySelectorAll(".wj-token");for(let t=0;t<e.length;t++)this._wjTpl.removeChild(e[t]);let t=this.selectedItems;if(t&&0!==t.length){for(let e=0;e<t.length;e++)this._insertToken(t[e]);this._wjInput.style.cssFloat=this.rightToLeft?"right":"left";this._adjustInputWidth()}else{this._wjInput.style.cssFloat=this.rightToLeft?"right":"left";this._adjustInputWidth()}}_insertToken(e){let t=this._getItemText(e,!0);this.isContentHtml||(t=wijmo_1.escapeHtml(t));this._wjTpl.insertBefore(this._createItem(t),this._wjInput)}_updateMaxItems(){null!=this._maxSelItems&&this._selItems&&this._selItems.length>this._maxSelItems&&(this._selItems=this._selItems.slice(0,this._maxSelItems))}_updateFocus(){let e=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);if(e){wijmo_1.removeClass(e,MultiAutoComplete._clsActive);setTimeout(()=>{this._tbx.focus()})}else this._clearSelIndex()}_addItem(e){if(this.selectedItems.indexOf(this.selectedItem)>-1)this._clearSelIndex();else if(this.selectedIndex>-1){this._updateSelItems(this.selectedItem,!0);this._refreshHeader();e&&this._clearSelIndex();this._disableInput(!0)}}_delItem(e){let t,i,s=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive),n=!1;if(!e||s){if(s){if((i=this._getItemIndex(s))>-1){t=this._selItems[i];n=!0}}else if(this._selItems.length>0){t=this._selItems[this._selItems.length-1];n=!0}if(n){this._updateSelItems(t,!1);this._refreshHeader();this._clearSelIndex();this._disableInput(!1)}this._tbx.focus()}}_updateSelItems(e,t){if(t){this._selItems&&0!==this._selItems.length||(this._selItems=[]);if(null!=this._maxSelItems&&this._selItems.length>=this._maxSelItems)return;this._selItems.push(e)}else{let t=this._selItems.indexOf(e);this._selItems.splice(t,1)}this._hasSelectedMemeberPath()&&this._setSelItem(e,t);this.onSelectedItemsChanged()}_createItem(e){let t=document.createElement("div"),i=document.createElement("span"),s=document.createElement("a");t.appendChild(i);t.appendChild(s);t.className="wj-token";i.className="wj-token-label";i.innerHTML=e;s.className="wj-token-close";s.href="#";s.tabIndex=-1;s.text="×";t.style.cssFloat=this.rightToLeft?"right":"left";this.addEventListener(t,"click",e=>{this._helperInput.focus();let i=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);i&&wijmo_1.removeClass(i,MultiAutoComplete._clsActive);wijmo_1.addClass(t,MultiAutoComplete._clsActive);e.stopPropagation();e.preventDefault()});this.addEventListener(s,"click",e=>{if(this.isReadOnly)return;let i=this._getItemIndex(t);if(i>-1){let e=this._selItems[i];this._updateSelItems(e,!1)}this._wjTpl.removeChild(t);this._adjustInputWidth();this._disableInput(!1);this._tbx.focus();e.stopPropagation();e.preventDefault()});return t}_itemOn(e){let t,i,s,n=wijmo_1.getActiveElement();if((this._tbx!=n||0===this._tbx.value.length)&&0!==(t=this._wjTpl.querySelectorAll(".wj-token")).length){i=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);s=this._getItemIndex(i);if(e){if(0===s)return;if(-1===s){wijmo_1.addClass(t[t.length-1],MultiAutoComplete._clsActive);this._helperInput.focus()}else{wijmo_1.removeClass(i,MultiAutoComplete._clsActive);wijmo_1.addClass(t[s-1],MultiAutoComplete._clsActive);this._helperInput.focus()}}else if(!e){if(-1===s)return;if(s!==t.length-1){wijmo_1.removeClass(i,MultiAutoComplete._clsActive);wijmo_1.addClass(t[s+1],MultiAutoComplete._clsActive);this._helperInput.focus()}else{wijmo_1.removeClass(i,MultiAutoComplete._clsActive);this._tbx.focus()}}}}_itemOff(){let e=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);e&&wijmo_1.removeClass(e,MultiAutoComplete._clsActive)}_initSeltems(){if(this.selectedMemberPath){this._selItems.splice(0,this._selItems.length);let e=this.collectionView;if(e)for(let t=0;t<e.sourceCollection.length;t++)this._getSelItem(t)&&this._selItems.push(e.sourceCollection[t])}}_getSelItem(e){let t=this.collectionView,i=t?t.sourceCollection[e]:null;return!(!wijmo_1.isObject(i)||!this.selectedMemberPath)&&this._selPath.getValue(i)}_setSelItem(e,t){this.itemsSource;wijmo_1.isObject(e)&&this._selPath.getValue(e)!=t&&this._selPath.setValue(e,t)}_clearSelIndex(){this.selectedIndex=-1}_hasSelectedMemeberPath(){return this.selectedMemberPath&&""!==this.selectedMemberPath}_disableInput(e){if(null!=this._maxSelItems)if(this._selItems.length<this._maxSelItems){this._tbx.disabled=!1;this._tbx.focus()}else{this._tbx.disabled=!0;this.hostElement.focus()}}_adjustInputWidth(){this._tbx.style.width="60px";let e,t=wijmo_1.getElementRect(this.hostElement),i=wijmo_1.getElementRect(this._tbx),s=getComputedStyle(this._tbx),n=parseInt(s.paddingLeft,10),h=parseInt(s.paddingRight,10);e=this.rightToLeft?i.left+i.width-t.left-n-h-8:t.left+t.width-i.left-n-h-8;this._tbx.style.width=e+"px"}_getItemIndex(e){let t=this.hostElement.querySelectorAll(".wj-token");for(let i=0;i<t.length;i++)if(e===t[i])return i;return-1}}MultiAutoComplete._clsActive="wj-token-active";exports.MultiAutoComplete=MultiAutoComplete;wijmo_1._registerModule("wijmo.input",selfModule);