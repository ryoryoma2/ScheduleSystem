/*!
    *
    * Wijmo Library 5.20203.748
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e;return t};Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_react_base_1=require("@grapecity/wijmo.react.base"),React=__importStar(require("react")),ReactDOM=__importStar(require("react-dom")),wjcCore=__importStar(require("@grapecity/wijmo")),wjcGrid=__importStar(require("@grapecity/wijmo.grid")),wjcInteropGrid=__importStar(require("@grapecity/wijmo.interop.grid"));exports.CellTemplateType=wjcInteropGrid.GridCellTemplateType;class FlexGrid extends wijmo_react_base_1.ComponentBase{constructor(e){super(e,wjcGrid.FlexGrid,{objectProps:["childItemsPath","mergeManager","itemsSource","virtualizationThreshold","columnGroups"]})}_createControl(){let e=super._createControl();new DirectiveCellFactory(this,e);return e}}exports.FlexGrid=FlexGrid;class FlexGridColumn extends wijmo_react_base_1.ComponentBase{constructor(e){super(e,wjcGrid.Column,{objectProps:["dataMap","cellTemplate","editor"]});this._parentProp="columns"}_initParent(){var e=this.parent.control;if(e.autoGenerateColumns){e.autoGenerateColumns=!1;e.columns.clear()}super._initParent()}}exports.FlexGridColumn=FlexGridColumn;class DirectiveCellFactory extends wjcInteropGrid.DirectiveCellFactoryBase{constructor(e,t){super(t);this._renderedCells=[];this._isViewUpdated=!1;t.updatedView.addHandler(this._gridViewUpdated,this);e._beforeDidUpdate.addHandler(this._gridCmpBeforeDidUpdate,this);e._afterDidUpdate.addHandler(this._gridCmpAfterDidUpdate,this)}shouldInstantiate(e){let t=e.templateCache;return null==t||t.column!==e.column||t.templateContextProperty!==e.templateContextProperty||e.cell.firstChild!=t.rootElement}renderTemplate(e,t){let r=e.row,l=e.templateContext,o=e.cell;e.cellBindingsData=this.setBindingsData({},r,e.column,r.dataItem,e.cellValue,l.valuePaths);this._renderCell(o,e);if(t){this._addRenderedCell(o);let t=e.templateCache={column:e.column,rootElement:o.firstElementChild,templateContextProperty:e.templateContextProperty};o[e.templateContextProperty]=t}}disposeTemplate(e,t,r){if(t){ReactDOM.unmountComponentAtNode(e);this._removeRenderedCell(e);super.disposeTemplate(e,t,r)}}clearCell(e){ReactDOM.unmountComponentAtNode(e)}applyImmediately(e){}flushPendingEvents(e){}getEditorFocusFlag(){return!0}setEditorFocusFlag(e){}_renderCell(e,t){var r=t||e.__wjCellLastRenderedProp;if(r){let t=r&&r.templateContext.template,l=r.cellBindingsData.localVars;ReactDOM.render(React.createElement("div",{},t&&t(l)),e);e.__wjCellLastRenderedProp=r}}_addRenderedCell(e){let t=this._renderedCells;t.indexOf(e)<0&&t.push(e)}_removeRenderedCell(e){let t=this._renderedCells,r=t.indexOf(e);r>-1&&t.splice(r,1)}_reRenderCells(){this._renderedCells.forEach(e=>this._renderCell(e))}_gridCmpBeforeDidUpdate(){this._isViewUpdated=!1}_gridCmpAfterDidUpdate(){this._gridCmpRendered()}_gridCmpRendered(){setTimeout(()=>{this._isViewUpdated?this._isViewUpdated=!1:this._reRenderCells()},wjcCore.Control._REFRESH_INTERVAL)}_gridViewUpdated(){this._isViewUpdated=!0}}class FlexGridCellTemplate extends React.Component{get cellOverflow(){return this.props.cellOverflow}get autoSizeRows(){let e=this.props.autoSizeRows;return null==e||e}get forceFullEdit(){let e=this.props.forceFullEdit;return null==e||e}get valuePaths(){return this.props.valuePaths}get template(){return this.props[FlexGridCellTemplate._CellRenderFuncProp]}componentDidMount(){let e=this.props[wijmo_react_base_1.ComponentBase._propsParent];e&&e._mountedCB(()=>{let t=this.ownerControl=e.control;if(t instanceof wjcGrid.FlexGrid)this.grid=t;else if(t instanceof wjcGrid.Column){this.column=t;this.grid=e.props[wijmo_react_base_1.ComponentBase._propsParent].control}this.template&&this._attachToControl()})}componentWillUnmount(){this._detachFromControl()}componentDidUpdate(e){let t=e[FlexGridCellTemplate._CellRenderFuncProp],r=this.template;t!=r&&(null==t?this._attachToControl():null==r&&this._detachFromControl())}render(){return null}_attachToControl(){let e=this.cellType=wjcCore.asEnum(this.props.cellType,exports.CellTemplateType),t=this.ownerControl;t[DirectiveCellFactory.getTemplContextProp(e)]=this;t instanceof wjcGrid.Column&&(e===exports.CellTemplateType.Cell||e===exports.CellTemplateType.ColumnHeader||e===exports.CellTemplateType.ColumnFooter)&&t._setFlag(wjcGrid.RowColFlags.HasTemplate,!0);this.grid.invalidate()}_detachFromControl(){if(null!=this.cellType){this.ownerControl[DirectiveCellFactory.getTemplContextProp(this.cellType)]=null;this.grid.invalidate()}}}FlexGridCellTemplate._CellRenderFuncProp="template";exports.FlexGridCellTemplate=FlexGridCellTemplate;